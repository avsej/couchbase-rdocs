<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Couchbase::Bucket
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (B)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Couchbase.html" title="Couchbase (module)">Couchbase</a></span></span>
     &raquo; 
    <span class="title">Bucket</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Couchbase::Bucket
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Couchbase::Bucket</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">ext/couchbase_ext/couchbase_ext.c<span class="defines">,<br />
  lib/couchbase/bucket.rb,<br /> ext/couchbase_ext/couchbase_ext.c</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This class in charge of all stuff connected to communication with
Couchbase.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Bucket/CouchRequest.html" title="Couchbase::Bucket::CouchRequest (class)">CouchRequest</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="FMT_MASK-constant" class="">FMT_MASK =
          <div class="docstring">
  <div class="discussion">
    <p>
Bitmask for flag bits responsible for format
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x03</span></pre></dd>
      
        <dt id="FMT_DOCUMENT-constant" class="">FMT_DOCUMENT =
          <div class="docstring">
  <div class="discussion">
    <p>
Document format. The (default) format supports most of ruby types which
could be mapped to JSON data (hashes, arrays, strings, numbers). Future
version will be able to run map/reduce queries on the values in the
document form (hashes).
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x00</span></pre></dd>
      
        <dt id="FMT_MARSHAL-constant" class="">FMT_MARSHAL =
          <div class="docstring">
  <div class="discussion">
    <p>
Marshal format. The format which supports transparent serialization of ruby
objects with standard <tt>Marshal.dump</tt> and <tt>Marhal.load</tt>
methods.
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x01</span></pre></dd>
      
        <dt id="FMT_PLAIN-constant" class="">FMT_PLAIN =
          <div class="docstring">
  <div class="discussion">
    <p>
Plain format. The format which force client don&#8217;t apply any
conversions to the value, but it should be passed as String. It could be
useful for building custom algorithms or formats. For example implement
set: <a
href="http://dustin.github.com/2011/02/17/memcached-set.html">dustin.github.com/2011/02/17/memcached-set.html</a>
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x02</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#authority-instance_method" title="#authority (instance method)">- (String) <strong>authority</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The authority (&#8220;hostname:port&#8221;) of the current node.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#bucket-instance_method" title="#bucket (instance method)">- (String) <strong>bucket</strong> </a>
    

    
      (also: #name)
    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The bucket name of the current connection.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_flags-instance_method" title="#default_flags (instance method)">- (Fixnum) <strong>default_flags</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Default flags for new values.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_format-instance_method" title="#default_format (instance method)">- (Symbol) <strong>default_format</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Default format for new values.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_observe_timeout-instance_method" title="#default_observe_timeout (instance method)">- (Fixnum) <strong>default_observe_timeout</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The default timeout value for <span class='object_link'><a href="#observe_and_wait-instance_method" title="Couchbase::Bucket#observe_and_wait (method)">#observe_and_wait</a></span> operation in
microseconds.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#environment-instance_method" title="#environment (instance method)">- (Symbol) <strong>environment</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The environment of the connection (<tt>:development</tt> or
<tt>:production</tt>).
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#hostname-instance_method" title="#hostname (instance method)">- (String) <strong>hostname</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The hostname of the current node.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#key_prefix-instance_method" title="#key_prefix (instance method)">- (String) <strong>key_prefix</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#num_replicas-instance_method" title="#num_replicas (instance method)">- (Fixnum) <strong>num_replicas</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The numbers of the replicas for each node in the cluster.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_error-instance_method" title="#on_error (instance method)">- (Proc) <strong>on_error</strong> {|op, key, exc| ... }</a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Error callback for asynchronous mode.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#password-instance_method" title="#password (instance method)">- (String) <strong>password</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The password used to connect to the cluster.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#pool-instance_method" title="#pool (instance method)">- (String) <strong>pool</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The pool name of the current connection.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#port-instance_method" title="#port (instance method)">- (Fixnum) <strong>port</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The port of the current node.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#quiet-instance_method" title="#quiet (instance method)">- (true, false) <strong>quiet</strong> </a>
    

    
      (also: #quiet?)
    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Flag specifying behaviour for operations on missing keys.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout-instance_method" title="#timeout (instance method)">- (Fixnum) <strong>timeout</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#url-instance_method" title="#url (instance method)">- (String) <strong>url</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The config url for this connection.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#username-instance_method" title="#username (instance method)">- (String) <strong>username</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The user name used to connect to the cluster.
</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add-instance_method" title="#add (instance method)">- (Fixnum) <strong>add</strong>(key, value, options = {}) {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Add the item to the database, but fail if the object exists already.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#all_docs-instance_method" title="#all_docs (instance method)">- (Couchbase::View) <strong>all_docs</strong>(params = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Fetch all documents from the bucket.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#append-instance_method" title="#append (instance method)">- (Fixnum) <strong>append</strong>(key, value, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Append this object to the existing object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#async%3F-instance_method" title="#async? (instance method)">- (true, ...) <strong>async?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Check whether the connection asynchronous.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cas-instance_method" title="#cas (instance method)">- (Fixnum) <strong>cas</strong>(key, options = {}) {|value| ... }</a>
    

    
      (also: #compare_and_swap)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Compare and swap value.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connected%3F-instance_method" title="#connected? (instance method)">- (true, ...) <strong>connected?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Check whether the instance connected to the cluster.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_periodic_timer-instance_method" title="#create_periodic_timer (instance method)">- (Couchbase::Timer) <strong>create_periodic_timer</strong>(interval, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Create and register periodic timer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_timer-instance_method" title="#create_timer (instance method)">- (Couchbase::Timer) <strong>create_timer</strong>(interval, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Create and register one-shot timer.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decr-instance_method" title="#decr (instance method)">- (Fixnum) <strong>decr</strong>(key, delta = 1, options = {}) {|ret| ... }</a>
    

    
      (also: #decrement)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Decrement the value of an existing numeric key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-instance_method" title="#delete (instance method)">- (true, ...) <strong>delete</strong>(key, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Delete the specified key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete_design_doc-instance_method" title="#delete_design_doc (instance method)">- (true, false) <strong>delete_design_doc</strong>(id, rev = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Delete design doc with given id and revision.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#design_docs-instance_method" title="#design_docs (instance method)">- (Hash) <strong>design_docs</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Fetch design docs stored in current bucket.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disconnect-instance_method" title="#disconnect (instance method)">- (true) <strong>disconnect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Close the connection to the cluster.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush-instance_method" title="#flush (instance method)">- (true) <strong>flush</strong> {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Delete contents of the bucket.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get-instance_method" title="#get (instance method)">- (Object) <strong>get</strong> </a>
    

    
      (also: #[])
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Obtain an object stored in Couchbase by given key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#incr-instance_method" title="#incr (instance method)">- (Fixnum) <strong>incr</strong>(key, delta = 1, options = {}) {|ret| ... }</a>
    

    
      (also: #increment)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Increment the value of an existing numeric key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Bucket) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Initialize new Bucket.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_copy-instance_method" title="#initialize_copy (instance method)">- (Couchbase::Bucket) <strong>initialize_copy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Initialize copy.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">- (String) <strong>inspect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns a string containing a human-readable representation of the
<span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span>.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make_http_request-instance_method" title="#make_http_request (instance method)">- (Couchbase::Bucket::CouchRequest) <strong>make_http_request</strong> {|res| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#observe-instance_method" title="#observe (instance method)">- (Hash&lt;String, Array&lt;Result&gt;&gt;, Array&lt;Result&gt;) <strong>observe</strong>(*keys, options = {}) {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Observe key state.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#observe_and_wait-instance_method" title="#observe_and_wait (instance method)">- (Fixnum, Hash&lt;String, Fixnum&gt;) <strong>observe_and_wait</strong>(*keys, &amp;block) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Wait for persistence condition.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prepend-instance_method" title="#prepend (instance method)">- (Object) <strong>prepend</strong>(key, value, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Prepend this object to the existing object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reconnect-instance_method" title="#reconnect (instance method)">- (Object) <strong>reconnect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Reconnect the bucket.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#replace-instance_method" title="#replace (instance method)">- (Fixnum) <strong>replace</strong>(key, value, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Replace the existing object in the database.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (nil) <strong>run</strong> {|bucket| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Run the event loop.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_design_doc-instance_method" title="#save_design_doc (instance method)">- (true, false) <strong>save_design_doc</strong>(data) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Update or create design doc with supplied views.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set-instance_method" title="#set (instance method)">- (Fixnum) <strong>set</strong>(key, value, options = {}) {|ret| ... }</a>
    

    
      (also: #[]=)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Unconditionally store the object in the Couchbase.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stats-instance_method" title="#stats (instance method)">- (Hash) <strong>stats</strong>(arg = nil) {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Request server statistics.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">- (nil) <strong>stop</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Stop the event loop.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#touch-instance_method" title="#touch (instance method)">- (Object) <strong>touch</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Update the expiry time of an item.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#unlock-instance_method" title="#unlock (instance method)">- (Object) <strong>unlock</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Unlock key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#version-instance_method" title="#version (instance method)">- (Hash) <strong>version</strong> {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns versions of the server for each node in the cluster.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    
      <span class="overload">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>) <strong>initialize</strong>(url, options = {}) </span>
    
      <span class="overload">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>) <strong>initialize</strong>(options = {}) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Initialize new Bucket.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Initialize connection using default options
</p>
</div></p>
      
      <pre class="example code"><span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Select custom bucket
</p>
</div></p>
      
      <pre class="example code"><span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:bucket</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>foo</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://localhost:8091/pools/default/buckets/foo</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Connect to protected bucket
</p>
</div></p>
      
      <pre class="example code"><span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:bucket</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>protected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:username</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>protected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:password</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>secret</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://localhost:8091/pools/default/buckets/protected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
              <span class='symbol'>:username</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>protected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:password</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>secret</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use list of nodes, in case some nodes might be dead
</p>
</div></p>
      
      <pre class="example code"><span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:node_list</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>example.com:8091</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>example.org:8091</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>example.net</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span></pre>
    
  </div>

  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>) <strong>initialize</strong>(url, options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
Initialize bucket using URI of the cluster and options. It is possible to
override some parts of URI using the options keys (e.g. :host or :port)
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The full URL of management API of the cluster.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The options for connection. See options definition below.
</p>
</div>
      
    </li>
  
</ul>


</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>) <strong>initialize</strong>(options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
Initialize bucket using options only.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The options for operation for connection
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:node_list</span>
          <span class="type">(<tt>Array</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the list of nodes to connect to. If specified it takes precedence over
<tt>:host</tt> option. The list must be array of strings in form of host
names or host names with ports (in first case port 8091 will be used, see
examples).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:host</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;localhost&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the hostname or IP address of the node
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:port</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>8091</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the port of the managemenent API
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:pool</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;default&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the pool name
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:bucket</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;default&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the bucket name
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:default_ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>0</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the TTL used by default during storing key-value pairs.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:default_flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>0</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the default flags.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:default_format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:document</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the format, which will be used for values by default. Note that changing
format will amend flags. (see <span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>)
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:username</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the user name to connect to the cluster. Used to authenticate on management
API. The username could be skipped for protected buckets, the bucket name
will be used instead.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:password</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the password of the user.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:quiet</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the flag controlling if raising exception when the client executes
operations on unexising keys. If it is <tt>true</tt> it will raise
<span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Error::NotFound</a></span> exceptions. The default behaviour is to return
<tt>nil</tt> value silently (might be useful in Rails cache).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:environment</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:production</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the mode of the connection. Currently it influences only on design
documents set. If the environment is <tt>:development</tt>, you will able
to get design documents with &#8216;dev_&#8217; prefix, otherwise (in
<tt>:production</tt> mode) the library will hide them from you.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:key_prefix</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the prefix string which will be prepended to each key before sending out,
and sripped before returning back to the application.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:timeout</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>2500000</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the timeout for IO operations (in microseconds)
</p>
</div>
          
        </li>
      
    </ul>
  


</div>
      </li>
    
  </ul>

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/BucketNotFound.html" title="Couchbase::Error::BucketNotFound (class)">Couchbase::Error::BucketNotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if there no such bucket to connect
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the socket wasn&#8217;t accessible (doesn&#8217;t accept connections or
doesn&#8217;t respond in time)
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 387</span>

VALUE
cb_bucket_init(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);

    bucket-&gt;self = self;
    bucket-&gt;exception = Qnil;
    bucket-&gt;hostname = strdup(&quot;localhost&quot;);
    bucket-&gt;port = 8091;
    bucket-&gt;pool = strdup(&quot;default&quot;);
    bucket-&gt;bucket = strdup(&quot;default&quot;);
    bucket-&gt;async = 0;
    bucket-&gt;quiet = 0;
    bucket-&gt;default_ttl = 0;
    bucket-&gt;default_flags = 0;
    bucket-&gt;default_format = sym_document;
    bucket-&gt;default_observe_timeout = 2500000;
    bucket-&gt;on_error_proc = Qnil;
    bucket-&gt;timeout = 0;
    bucket-&gt;environment = sym_production;
    bucket-&gt;key_prefix = NULL;
    bucket-&gt;key_prefix_val = Qnil;
    bucket-&gt;node_list = NULL;
    bucket-&gt;object_space = rb_hash_new();
    bucket-&gt;node_list = NULL;

    do_scan_connection_options(bucket, argc, argv);
    do_connect(bucket);

    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="authority-instance_method">
  
    - (<tt>String</tt>) <strong>authority</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The authority (&#8220;hostname:port&#8221;) of the current node
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
host with port
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#url-instance_method" title="Couchbase::Bucket#url (method)">#url</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


729
730
731
732
733
734
735
736
737
738
739
740
741
742
743
744</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 729</span>

VALUE
cb_bucket_authority_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    size_t len;

    (void)cb_bucket_hostname_get(self);
    (void)cb_bucket_port_get(self);
    len = strlen(bucket-&gt;hostname) + 10;
    bucket-&gt;authority = xcalloc(len, sizeof(char));
    if (bucket-&gt;authority == NULL) {
        rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for Bucket&quot;);
    }
    snprintf(bucket-&gt;authority, len, &quot;%s:%u&quot;, bucket-&gt;hostname, bucket-&gt;port);
    return STR_NEW_CSTR(bucket-&gt;authority);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="bucket-instance_method">
  
    - (<tt>String</tt>) <strong>bucket</strong>  <span class="extras">(readonly)</span>
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='name-instance_method'>name</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The bucket name of the current connection
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the bucket name
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#url-instance_method" title="Couchbase::Bucket#url (method)">#url</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


752
753
754
755
756
757</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 752</span>

VALUE
cb_bucket_bucket_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return STR_NEW_CSTR(bucket-&gt;bucket);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="default_flags=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="default_flags-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>default_flags</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
Amending format bit will also change #default_format value
</p>
</div>
  </div>

<p>
Default flags for new values.
</p>
<p>
The library reserves last two lower bits to store the format of the value.
The can be masked via FMT_MASK constant.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Selecting format bits
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_default_flags'>default_flags</span> <span class='op'>&amp;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Bucket</span><span class='op'>::</span><span class='const'>FMT_MASK</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Set user defined bits
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_default_flags'>default_flags</span> <span class='op'>|=</span> <span class='int'>0x6660</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the effective flags
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


573
574
575
576
577
578</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 573</span>

VALUE
cb_bucket_default_flags_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return ULONG2NUM(bucket-&gt;default_flags);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="default_format=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="default_format-instance_method">
  
    - (<tt>Symbol</tt>) <strong>default_format</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
Amending default_format will also change #default_flags value
</p>
</div>
  </div>

<p>
Default format for new values.
</p>
<p>
It uses flags field to store the format. It accepts either the Symbol
(<tt>:document</tt>, <tt>:marshal</tt>, <tt>:plain</tt>) or Fixnum (use
constants FMT_DOCUMENT, FMT_MARSHAL, FMT_PLAIN) and silently ignores all
other value.
</p>
<p>
Here is some notes regarding how to choose the format:
</p>
<ul>
<li><p>
<tt>:document</tt> (default) format supports most of ruby types which could
be mapped to JSON data (hashes, arrays, strings, numbers). Future version
will be able to run map/reduce queries on the values in the document form
(hashes).
</p>
</li>
<li><p>
<tt>:plain</tt> format if you no need any conversions to be applied to your
data, but your data should be passed as String. It could be useful for
building custom algorithms or formats. For example implement set: <a
href="http://dustin.github.com/2011/02/17/memcached-set.html">dustin.github.com/2011/02/17/memcached-set.html</a>
</p>
</li>
<li><p>
<tt>:marshal</tt> format if you&#8217;d like to transparently serialize
your ruby object with standard <tt>Marshal.dump</tt> and
<tt>Marhal.load</tt> methods.
</p>
</li>
</ul>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Selecting plain format using symbol
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span> <span class='op'>=</span> <span class='symbol'>:document</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Selecting plain format using Fixnum constant
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span> <span class='op'>=</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Bucket</span><span class='op'>::</span><span class='const'>FMT_PLAIN</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the effective format
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://couchbase.com/docs/couchbase-manual-2.0/couchbase-views-datastore.html" target="_parent" title="http://couchbase.com/docs/couchbase-manual-2.0/couchbase-views-datastore.html">http://couchbase.com/docs/couchbase-manual-2.0/couchbase-views-datastore.html</a></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


590
591
592
593
594
595</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 590</span>

VALUE
cb_bucket_default_format_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return bucket-&gt;default_format;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="default_observe_timeout=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="default_observe_timeout-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>default_observe_timeout</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The default timeout value for <span class='object_link'><a href="#observe_and_wait-instance_method" title="Couchbase::Bucket#observe_and_wait (method)">#observe_and_wait</a></span> operation in
microseconds
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0.dp6
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


841
842
843
844
845
846</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 841</span>

VALUE
cb_bucket_default_observe_timeout_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return INT2FIX(bucket-&gt;default_observe_timeout);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="environment-instance_method">
  
    - (<tt>Symbol</tt>) <strong>environment</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The environment of the connection (<tt>:development</tt> or
<tt>:production</tt>)
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


807
808
809
810
811
812</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 807</span>

VALUE
cb_bucket_environment_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return bucket-&gt;environment;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="hostname-instance_method">
  
    - (<tt>String</tt>) <strong>hostname</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The hostname of the current node
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the host name of the management interface (default:
&#8220;localhost&#8221;)
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#url-instance_method" title="Couchbase::Bucket#url (method)">#url</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


693
694
695
696
697
698
699
700
701
702
703
704
705</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 693</span>

VALUE
cb_bucket_hostname_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    if (bucket-&gt;handle) {
        xfree(bucket-&gt;hostname);
        bucket-&gt;hostname = strdup(lcb_get_host(bucket-&gt;handle));
        if (bucket-&gt;hostname == NULL) {
            rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for Bucket&quot;);
        }
    }
    return STR_NEW_CSTR(bucket-&gt;hostname);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="key_prefix=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="key_prefix-instance_method">
  
    - (<tt>String</tt>) <strong>key_prefix</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The library will prepend <tt>key_prefix</tt> to each key to provide simple
namespacing.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The library will prepend <tt>key_prefix</tt> to each key to provide simple
namespacing.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0.dp5
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


669
670
671
672
673
674</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 669</span>

VALUE
cb_bucket_key_prefix_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return bucket-&gt;key_prefix_val;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="num_replicas-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>num_replicas</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The numbers of the replicas for each node in the cluster
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0.dp6
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


821
822
823
824
825
826
827
828
829
830
831</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 821</span>

VALUE
cb_bucket_num_replicas_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    int32_t nr = lcb_get_num_replicas(bucket-&gt;handle);
    if (nr &lt; 0) {
        return Qnil;
    } else {
        return INT2FIX(nr);
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="on_error=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="on_error-instance_method">
  
    - (<tt>Proc</tt>) <strong>on_error</strong> {|op, key, exc| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Error callback for asynchronous mode.
</p>
<p>
This callback is using to deliver exceptions in asynchronous mode.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Using lambda syntax
</p>
</div></p>
      
      <pre class="example code">connection = Couchbase.new(:async =&gt; true)
connection.on_error = lambda {|op, key, exc| ... }
connection.run do |conn|
  conn.set(&quot;foo&quot;, &quot;bar&quot;)
end</pre>
    
      
        <p class="example_title"><div class='inline'><p>
Using block syntax
</p>
</div></p>
      
      <pre class="example code">connection = Couchbase.new(:async =&gt; true)
connection.on_error {|op, key, exc| ... }
...</pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>op</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The operation caused the error
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The key which cause the error or <tt>nil</tt>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exc</span>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The exception instance
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the effective callback
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


637
638
639
640
641
642
643
644
645
646
647</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 637</span>

VALUE
cb_bucket_on_error_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);

    if (rb_block_given_p()) {
        return cb_bucket_on_error_set(self, rb_block_proc());
    } else {
        return bucket-&gt;on_error_proc;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="password-instance_method">
  
    - (<tt>String</tt>) <strong>password</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The password used to connect to the cluster
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the password for protected buckets
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


792
793
794
795
796
797</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 792</span>

VALUE
cb_bucket_password_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return STR_NEW_CSTR(bucket-&gt;password);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="pool-instance_method">
  
    - (<tt>String</tt>) <strong>pool</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The pool name of the current connection
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the pool name (usually &#8220;default&#8221;)
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#url-instance_method" title="Couchbase::Bucket#url (method)">#url</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


765
766
767
768
769
770</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 765</span>

VALUE
cb_bucket_pool_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return STR_NEW_CSTR(bucket-&gt;pool);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="port-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>port</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The port of the current node
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the port number of the management interface (default: 8091)
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#url-instance_method" title="Couchbase::Bucket#url (method)">#url</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


713
714
715
716
717
718
719
720
721</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 713</span>

VALUE
cb_bucket_port_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    if (bucket-&gt;handle) {
        bucket-&gt;port = atoi(lcb_get_port(bucket-&gt;handle));
    }
    return UINT2NUM(bucket-&gt;port);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="quiet=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="quiet-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>quiet</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='quiet?-instance_method'>quiet?</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Flag specifying behaviour for operations on missing keys
</p>
<p>
If it is <tt>true</tt>, the operations will silently return <tt>nil</tt> or
<tt>false</tt> instead of raising <span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Error::NotFound</a></span>.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Hiding cache miss (considering &#8220;miss&#8221; key is not stored)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_quiet'>quiet</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>miss</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'>#=&gt; nil</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Raising errors on miss (considering &#8220;miss&#8221; key is not stored)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_quiet'>quiet</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>miss</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'>#=&gt; will raise Couchbase::Error::NotFound</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


555
556
557
558
559
560</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 555</span>

VALUE
cb_bucket_quiet_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return bucket-&gt;quiet ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="timeout=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="timeout-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>timeout</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The timeout for the operations in microseconds. The client will raise
<span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Error::Timeout</a></span> exception for all commands which weren&#8217;t
completed in given timeslot.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The timeout for the operations in microseconds. The client will raise
<span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Error::Timeout</a></span> exception for all commands which weren&#8217;t
completed in given timeslot.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.1.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


649
650
651
652
653
654</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 649</span>

VALUE
cb_bucket_timeout_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return ULONG2NUM(bucket-&gt;timeout);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="url-instance_method">
  
    - (<tt>String</tt>) <strong>url</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The config url for this connection.
</p>
<p>
Generally it is the bootstrap URL, but it could be different after cluster
upgrade. This url is used to fetch the cluster configuration.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the address of the cluster management interface
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


870
871
872
873
874
875
876
877
878
879
880
881
882
883
884
885</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 870</span>

VALUE
cb_bucket_url_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    VALUE str;

    (void)cb_bucket_authority_get(self);
    str = rb_str_buf_new2(&quot;http://&quot;);
    rb_str_buf_cat2(str, bucket-&gt;authority);
    rb_str_buf_cat2(str, &quot;/pools/&quot;);
    rb_str_buf_cat2(str, bucket-&gt;pool);
    rb_str_buf_cat2(str, &quot;/buckets/&quot;);
    rb_str_buf_cat2(str, bucket-&gt;bucket);
    rb_str_buf_cat2(str, &quot;/&quot;);
    return str;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="username-instance_method">
  
    - (<tt>String</tt>) <strong>username</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The user name used to connect to the cluster
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the username for protected buckets (usually matches the bucket name)
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#url-instance_method" title="Couchbase::Bucket#url (method)">#url</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


779
780
781
782
783
784</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 779</span>

VALUE
cb_bucket_username_get(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return STR_NEW_CSTR(bucket-&gt;username);
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>add</strong>(key, value, options = {}) {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Add the item to the database, but fail if the object exists already
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The CAS value of the object.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Add the same key twice
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; stored successully
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; will raise Couchbase::Error::KeyExists: failed to store value (key=&quot;foo&quot;, error=0x0c)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Ensure that the key will be persisted at least on the one node
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:observe</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:persisted</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_flags</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Flags for storage options. Flags are ignored by the server but preserved
for use by the client. For more info see <span class='object_link'><a href="#default_flags-instance_method" title="Couchbase::Bucket#default_flags (method)">#default_flags</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:observe</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
Apply persistence condition before returning result. When this option
specified the library will observe given condition. See
<span class='object_link'><a href="#observe_and_wait-instance_method" title="Couchbase::Bucket#observe_and_wait (method)">#observe_and_wait</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CAS value of the object.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key already exists on the server
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/ValueFormat.html" title="Couchbase::Error::ValueFormat (class)">Couchbase::Error::ValueFormat</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the value cannot be serialized with chosen encoder, e.g. if you try to
store the Hash in <tt>:plain</tt> mode.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Couchbase::Error::Timeout</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if timeout interval for observe exceeds
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


315
316
317
318
319</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/store.c', line 315</span>

VALUE
cb_bucket_add(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LCB_ADD, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="all_docs-instance_method">
  
    - (<tt><span class='object_link'><a href="View.html" title="Couchbase::View (class)">Couchbase::View</a></span></tt>) <strong>all_docs</strong>(params = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Fetch all documents from the bucket.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>params</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Params for Couchbase <tt>/_all_docs</tt> query
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="View.html" title="Couchbase::View (class)">Couchbase::View</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
View object
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


127
128
129</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 127</span>

<span class='kw'>def</span> <span class='id identifier rubyid_all_docs'>all_docs</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='const'>View</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>_all_docs</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="append-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>append</strong>(key, value, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
This operation is kind of data-aware from server point of view. This mean
that the server treats value as binary stream and just perform
concatenation, therefore it won&#8217;t work with <tt>:marshal</tt> and
<tt>:document</tt> formats, because of lack of knowledge how to merge
values in these formats. See <span class='object_link'><a href="#cas-instance_method" title="Couchbase::Bucket#cas (method)">#cas</a></span> for workaround.
</p>
</div>
  </div>

<p>
Append this object to the existing object
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The CAS value of the object.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Simple append
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bbb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>           <span class='comment'>#=&gt; &quot;aaabbb&quot;</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Implementing sets using append
</p>
</div></p>
      
      <pre class="example code"><span class='kw'>def</span> <span class='id identifier rubyid_set_add'>set_add</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>+</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
  <span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded'>encoded</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_remove'>set_remove</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
  <span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded'>encoded</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_get'>set_get</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>=</span> <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_encoded'>encoded</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_op'>op</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_op'>op</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>+</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ret'>ret</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Using optimistic locking. The operation will fail on CAS mismatch
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_ver'>ver</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bbb</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ver'>ver</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Ensure that the key will be persisted at least on the one node
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:observe</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:persisted</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:observe</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
Apply persistence condition before returning result. When this option
specified the library will observe given condition. See
<span class='object_link'><a href="#observe_and_wait-instance_method" title="Couchbase::Bucket#observe_and_wait (method)">#observe_and_wait</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CAS value of the object.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
on CAS mismatch
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotStored.html" title="Couchbase::Error::NotStored (class)">Couchbase::Error::NotStored</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key doesn&#8217;t exist
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Couchbase::Error::Timeout</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if timeout interval for observe exceeds
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


443
444
445
446
447</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/store.c', line 443</span>

VALUE
cb_bucket_append(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LCB_APPEND, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="async?-instance_method">
  
    - (<tt>true</tt>, ...) <strong>async?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Check whether the connection asynchronous.
</p>
<p>
By default all operations are synchronous and block waiting for results,
but you can make them asynchronous and run event loop explicitly. (see
<span class='object_link'><a href="#run-instance_method" title="Couchbase::Bucket#run (method)">#run</a></span>)
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Return value of #get operation depending on async flag
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_async?'>async?</span>      <span class='comment'>#=&gt; false
</span>
<span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_conn'>conn</span><span class='op'>|</span>
  <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_async?'>async?</span>          <span class='comment'>#=&gt; true
</span><span class='kw'>end</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<tt>true</tt> if the connection if asynchronous
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#run-instance_method" title="Couchbase::Bucket#run (method)">#run</a></span></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


548
549
550
551
552
553</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 548</span>

VALUE
cb_bucket_async_p(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return bucket-&gt;async ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cas-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>cas</strong>(key, options = {}) {|value| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='compare_and_swap-instance_method'>compare_and_swap</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Compare and swap value.
</p>
<p>
Reads a key&#8217;s value from the server and yields it to a block.
Replaces the key&#8217;s value with the result of the block as long as the
key hasn&#8217;t been updated in the meantime, otherwise raises
<span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Error::KeyExists</a></span>. CAS stands for &#8220;compare and
swap&#8221;, and avoids the need for manual key mutexing. Read more info
here:
</p>
<p>
In asynchronous mode it will yield result twice, first for <span class='object_link'><a href="#get-instance_method" title="Couchbase::Bucket#get (method)">#get</a></span>
with <span class='object_link'><a href="Result.html#operation-instance_method" title="Couchbase::Result#operation (method)">Result#operation</a></span> equal to <tt>:get</tt> and second time for
<span class='object_link'><a href="#set-instance_method" title="Couchbase::Bucket#set (method)">#set</a></span> with <span class='object_link'><a href="Result.html#operation-instance_method" title="Couchbase::Result#operation (method)">Result#operation</a></span> equal to <tt>:set</tt>.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Implement append to JSON encoded value
</p>
</div></p>
      
      <pre class="example code">
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_default_format'>default_format</span> <span class='op'>=</span> <span class='symbol'>:document</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
  <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>2</span>
  <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>      <span class='comment'>#=&gt; {&quot;bar&quot; =&gt; 1, &quot;baz&quot; =&gt; 2}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Append JSON encoded value asynchronously
</p>
</div></p>
      
      <pre class="example code">
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_default_format'>default_format</span> <span class='op'>=</span> <span class='symbol'>:document</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_val'>val</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>
    <span class='kw'>when</span> <span class='symbol'>:get</span>
      <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>2</span>
      <span class='id identifier rubyid_val'>val</span>
    <span class='kw'>when</span> <span class='symbol'>:set</span>
      <span class='comment'># verify all is ok
</span>      <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rbrace'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>      <span class='comment'>#=&gt; {&quot;bar&quot; =&gt; 1, &quot;baz&quot; =&gt; 2}</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
the options for &#8220;swap&#8221; part
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the time to live of this key
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
format of the value
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_flags</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
flags for this key
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>, <tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
old value in synchronous mode and <tt>Result</tt> object in asynchronous
mode.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
new value.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the CAS of new value
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key was updated before the the code in block has been completed (the
CAS value has been changed).
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the block is missing for async mode
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://couchbase.com/docs/memcached-api/memcached-api-protocol-text_cas.html" target="_parent" title="http://couchbase.com/docs/memcached-api/memcached-api-protocol-text_cas.html">http://couchbase.com/docs/memcached-api/memcached-api-protocol-text_cas.html</a></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90
91
92
93
94</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 82</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cas'>cas</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_async?'>async?</span>
    <span class='id identifier rubyid_block'>block</span> <span class='op'>=</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
      <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span><span class='period'>.</span><span class='id identifier rubyid_call'>call</span><span class='lparen'>(</span><span class='id identifier rubyid_ret'>ret</span><span class='rparen'>)</span> <span class='comment'># get new value from caller
</span>      <span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span><span class='comma'>,</span> <span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_flags'>flags</span><span class='rparen'>)</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_ver'>ver</span> <span class='op'>=</span> <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span> <span class='comment'># get new value from caller
</span>    <span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ver'>ver</span><span class='comma'>,</span> <span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_flags'>flags</span><span class='rparen'>)</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connected?-instance_method">
  
    - (<tt>true</tt>, ...) <strong>connected?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Check whether the instance connected to the cluster.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<tt>true</tt> if the instance connected to the cluster
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.1.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


520
521
522
523
524
525</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 520</span>

VALUE
cb_bucket_connected_p(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    return bucket-&gt;handle ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_periodic_timer-instance_method">
  
    - (<tt><span class='object_link'><a href="Timer.html" title="Couchbase::Timer (class)">Couchbase::Timer</a></span></tt>) <strong>create_periodic_timer</strong>(interval, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Create and register periodic timer
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Timer.html" title="Couchbase::Timer (class)">Couchbase::Timer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


263
264
265</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 263</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_periodic_timer'>create_periodic_timer</span><span class='lparen'>(</span><span class='id identifier rubyid_interval'>interval</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='const'>Timer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_interval'>interval</span><span class='comma'>,</span> <span class='symbol'>:periodic</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_timer-instance_method">
  
    - (<tt><span class='object_link'><a href="Timer.html" title="Couchbase::Timer (class)">Couchbase::Timer</a></span></tt>) <strong>create_timer</strong>(interval, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Create and register one-shot timer
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Timer.html" title="Couchbase::Timer (class)">Couchbase::Timer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 256</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_timer'>create_timer</span><span class='lparen'>(</span><span class='id identifier rubyid_interval'>interval</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='const'>Timer</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_interval'>interval</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decr-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>decr</strong>(key, delta = 1, options = {}) {|ret| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='decrement-instance_method'>decrement</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
that server values stored and transmitted as unsigned numbers, therefore if
you try to decrement negative or zero key, you will always get zero.
</p>
</div>
  </div>

<p>
Decrement the value of an existing numeric key
</p>
<p>
The decrement methods reduce the value of a given key if the corresponding
value can be parsed to an integer value. These operations are provided at a
protocol level to eliminate the need to get, update, and reset a simple
integer value in the database. It supports the use of an explicit offset
value that will be used to reduce the stored value in the database.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The actual value of the key.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key by one
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key by 50
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>50</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key by one <b>OR</b> initialize with zero
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:create</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; will return old-1 or 0</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key by one <b>OR</b> initialize with three
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>50</span><span class='comma'>,</span> <span class='symbol'>:initial</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='rparen'>)</span> <span class='comment'>#=&gt; will return old-50 or 3</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key and get its CAS value
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_cas'>cas</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrementing zero
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decrement'>decrement</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>100500</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; 0</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrementing negative value
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>100</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decrement'>decrement</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>100500</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; 0</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous invocation
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :decrement
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot;
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>delta</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Integer (up to 64 bits) value to decrement
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:create</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, it will initialize the key with zero value and
zero flags (use <tt>:initial</tt> option to set another initial value).
Note: it won&#8217;t decrement the missing value.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:initial</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>0</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Integer (up to 64 bits) value for missing key initialization. This option
imply <tt>:create</tt> option is <tt>true</tt>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch). This option ignored for
existent keys.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:extended</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation will return tuple <tt>[value, cas]</tt>,
otherwise (by default) it returns just value.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>, <tt>value</tt>,
<tt>cas</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the actual value of the key.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if key is missing and <tt>:create</tt> option isn&#8217;t <tt>true</tt>.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/DeltaBadval.html" title="Couchbase::Error::DeltaBadval (class)">Couchbase::Error::DeltaBadval</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key contains non-numeric value
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


316
317
318
319
320</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/arithmetic.c', line 316</span>

VALUE
cb_bucket_decr(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_arithmetic(-1, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete-instance_method">
  
    - (<tt>true</tt>, ...) <strong>delete</strong>(key, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Delete the specified key
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The result of the operation
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Delete the key in quiet mode (default)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>        <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>        <span class='comment'>#=&gt; false</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Delete the key verbosely
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>    <span class='comment'>#=&gt; nil (default behaviour)
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; will raise Couchbase::Error::NotFound</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Delete the key with version check
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_ver'>ver</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>          <span class='comment'>#=&gt; 5992859822302167040
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='int'>123456</span><span class='rparen'>)</span>    <span class='comment'>#=&gt; will raise Couchbase::Error::KeyExists
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ver'>ver</span><span class='rparen'>)</span>       <span class='comment'>#=&gt; true</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:quiet</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.quiet</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation won&#8217;t raise error for missing
key, it will return <tt>nil</tt>. Otherwise it will raise error in
synchronous mode. In asynchronous mode this option ignored.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update/delete an item simultaneously.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>, <tt>Hash&lt;String, Boolean&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of the operation
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
on CAS mismatch
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if key is missing in verbose mode
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/delete.c', line 99</span>

VALUE
cb_bucket_delete(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    struct context_st *ctx;
    VALUE rv, exc;
    VALUE args, proc;
    lcb_error_t err;
    struct params_st params;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    rb_funcall(args, id_flatten_bang, 0);
    memset(&amp;params, 0, sizeof(struct params_st));
    params.type = cmd_remove;
    params.bucket = bucket;
    cb_params_build(&amp;params, RARRAY_LEN(args), args);

    ctx = xcalloc(1, sizeof(struct context_st));
    if (ctx == NULL) {
        rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    ctx-&gt;quiet = params.cmd.remove.quiet;
    ctx-&gt;proc = cb_gc_protect(bucket, proc);
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;bucket = bucket;
    ctx-&gt;exception = Qnil;
    ctx-&gt;nqueries = params.cmd.remove.num;
    err = lcb_remove(bucket-&gt;handle, (const void *)ctx,
            params.cmd.remove.num, params.cmd.remove.ptr);
    cb_params_destroy(&amp;params);
    exc = cb_check_error(err, &quot;failed to schedule delete request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    bucket-&gt;nbytes += params.npayload;
    if (bucket-&gt;async) {
        maybe_do_loop(bucket);
        return Qnil;
    } else {
        if (ctx-&gt;nqueries &gt; 0) {
            /* we have some operations pending */
            lcb_wait(bucket-&gt;handle);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            rb_exc_raise(cb_gc_unprotect(bucket, exc));
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        if (params.cmd.remove.num &gt; 1) {
            return rv;  /* return as a hash {key =&gt; true, ...} */
        } else {
            VALUE vv = Qnil;
            rb_hash_foreach(rv, cb_first_value_i, (VALUE)&amp;vv);
            return vv;
        }
        return rv;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete_design_doc-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>delete_design_doc</strong>(id, rev = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Delete design doc with given id and revision.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>id</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Design document id. It might have &#8216;_design/&#8217; prefix.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>rev</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
Document revision. It uses latest revision if <tt>rev</tt> parameter is
nil.
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 190</span>

<span class='kw'>def</span> <span class='id identifier rubyid_delete_design_doc'>delete_design_doc</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='id identifier rubyid_rev'>rev</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ddoc'>ddoc</span> <span class='op'>=</span> <span class='id identifier rubyid_design_docs'>design_docs</span><span class='lbracket'>[</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^_design\/</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='rbracket'>]</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_ddoc'>ddoc</span>
    <span class='kw'>yield</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_path'>path</span> <span class='op'>=</span> <span class='const'>Utils</span><span class='period'>.</span><span class='id identifier rubyid_build_query'>build_query</span><span class='lparen'>(</span><span class='id identifier rubyid_ddoc'>ddoc</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:rev</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_rev'>rev</span> <span class='op'>||</span> <span class='id identifier rubyid_ddoc'>ddoc</span><span class='period'>.</span><span class='id identifier rubyid_meta'>meta</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>rev</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='id identifier rubyid_make_http_request'>make_http_request</span><span class='lparen'>(</span><span class='id identifier rubyid_path'>path</span><span class='comma'>,</span> <span class='symbol'>:method</span> <span class='op'>=&gt;</span> <span class='symbol'>:delete</span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_rv'>rv</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_on_body'>on_body</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_res'>res</span><span class='op'>|</span>
    <span class='id identifier rubyid_rv'>rv</span> <span class='op'>=</span> <span class='id identifier rubyid_res'>res</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>error</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='op'>=</span> <span class='const'>Error</span><span class='op'>::</span><span class='const'>View</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>delete_design_doc</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>error</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_res'>res</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_continue'>continue</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_async?'>async?</span>
    <span class='id identifier rubyid_rv'>rv</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span> <span class='kw'>or</span> <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="design_docs-instance_method">
  
    - (<tt>Hash</tt>) <strong>design_docs</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Fetch design docs stored in current bucket
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 102</span>

<span class='kw'>def</span> <span class='id identifier rubyid_design_docs'>design_docs</span>
  <span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='id identifier rubyid_make_http_request'>make_http_request</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/pools/default/buckets/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bucket'>bucket</span><span class='rbrace'>}</span><span class='tstring_content'>/ddocs</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                          <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='symbol'>:management</span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_docmap'>docmap</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_on_body'>on_body</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_body'>body</span><span class='op'>|</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_body'>body</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_res'>res</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>rows</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_obj'>obj</span><span class='op'>|</span>
      <span class='id identifier rubyid_doc'>doc</span> <span class='op'>=</span> <span class='const'>ViewRow</span><span class='period'>.</span><span class='id identifier rubyid_wrap'>wrap</span><span class='lparen'>(</span><span class='kw'>self</span><span class='comma'>,</span> <span class='id identifier rubyid_obj'>obj</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_key'>key</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span><span class='period'>.</span><span class='id identifier rubyid_id'>id</span><span class='period'>.</span><span class='id identifier rubyid_sub'>sub</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^_design\/</span><span class='regexp_end'>/</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
      <span class='kw'>next</span> <span class='kw'>if</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_environment'>environment</span> <span class='op'>==</span> <span class='symbol'>:production</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_key'>key</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>dev_</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_docmap'>docmap</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_doc'>doc</span>
    <span class='kw'>end</span>
    <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_docmap'>docmap</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_continue'>continue</span>
  <span class='id identifier rubyid_async?'>async?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_docmap'>docmap</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disconnect-instance_method">
  
    - (<tt>true</tt>) <strong>disconnect</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Close the connection to the cluster
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.1.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 1076</span>

VALUE
cb_bucket_disconnect(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);

    if (bucket-&gt;handle) {
        lcb_destroy(bucket-&gt;handle);
        bucket-&gt;handle = NULL;
        bucket-&gt;io = NULL;
        return Qtrue;
    } else {
        rb_raise(eConnectError, &quot;closed connection&quot;);
        return Qfalse;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flush-instance_method">
  
    - (<tt>true</tt>) <strong>flush</strong> {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Delete contents of the bucket
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Simple flush the bucket
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>    <span class='comment'>#=&gt; true</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous flush
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :flush
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_status'>status</span>      <span class='comment'>#=&gt; 200
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the object with <tt>error</tt>, <tt>status</tt> and <tt>operation</tt>
attributes.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
always return true (see raise section)
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Protocol.html" title="Couchbase::Error::Protocol (class)">Couchbase::Error::Protocol</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
in case of an error is encountered. Check <span class='object_link'><a href="Error/Base.html#status-instance_method" title="Couchbase::Error::Base#status (method)">Error::Base#status</a></span>
for detailed code.
</p>
</div>
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://www.couchbase.com/docs/couchbase-manual-2.0/restapi-flushing-bucket.html" target="_parent" title="http://www.couchbase.com/docs/couchbase-manual-2.0/restapi-flushing-bucket.html">http://www.couchbase.com/docs/couchbase-manual-2.0/restapi-flushing-bucket.html</a></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0.beta
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


240
241
242
243
244
245
246
247
248
249
250
251</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 240</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flush'>flush</span>
  <span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='id identifier rubyid_make_http_request'>make_http_request</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/pools/default/buckets/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bucket'>bucket</span><span class='rbrace'>}</span><span class='tstring_content'>/controller/doFlush</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span>
                          <span class='symbol'>:type</span> <span class='op'>=&gt;</span> <span class='symbol'>:management</span><span class='comma'>,</span> <span class='symbol'>:method</span> <span class='op'>=&gt;</span> <span class='symbol'>:post</span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_on_body'>on_body</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_r'>r</span>
    <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>@operation</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:flush</span><span class='rparen'>)</span>
    <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_res'>res</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_continue'>continue</span>
  <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get-instance_method">
  
    
      <span class="overload">- (<tt>Object</tt>, ...) <strong>get</strong>(*keys, options = {}) {|ret| ... }</span>
    
      <span class="overload">- (<tt>Hash</tt>) <strong>get</strong>(keys, options = {}) </span>
    
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='[]-instance_method'>[]</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Obtain an object stored in Couchbase by given key.
</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Object</tt>, ...) <strong>get</strong>(*keys, options = {}) {|ret| ... }</span>
        <div class="docstring">
  <div class="discussion">
    <p>
The value(s) (or tuples in extended mode) assiciated with the key.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Get single value in quite mode (the default)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'>#=&gt; the associated value or nil</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use alternative hash-like syntax
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>         <span class='comment'>#=&gt; the associated value or nil</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get single value in verbose mode
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>missing-foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>  <span class='comment'>#=&gt; raises Couchbase::NotFound
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>missing-foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; returns nil</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get and touch single value. The key won&#8217;t be accessible after 10
seconds
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:ttl</span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Extended get
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_cas'>cas</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>   <span class='comment'>#=&gt; [val1, val2, val3]</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get multiple keys with assembing result into the Hash
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:assemble_hash</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; {&quot;foo&quot; =&gt; val1, &quot;bar&quot; =&gt; val2, &quot;baz&quot; =&gt; val3}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Extended get multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; {&quot;foo&quot; =&gt; [val1, flags1, cas1], &quot;bar&quot; =&gt; [val2, flags2, cas2]}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous get
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_res'>res</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :get
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot;, &quot;bar&quot; or &quot;baz&quot; in separate calls
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_flags'>flags</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get and lock key using default timeout
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:lock</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Determine lock timeout parameters
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='period'>.</span><span class='id identifier rubyid_values_at'>values_at</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ep_getl_default_timeout</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ep_getl_max_timeout</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; [{&quot;127.0.0.1:11210&quot;=&gt;&quot;15&quot;}, {&quot;127.0.0.1:11210&quot;=&gt;&quot;30&quot;}]</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get and lock key using custom timeout
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:lock</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get and lock multiple keys using custom timeout
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:lock</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
One or several keys to fetch
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:extended</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation will return tuple +[value, flags,
cas]+, otherwise (by default) it returns just value.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:quiet</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.quiet</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation won&#8217;t raise error for missing
key, it will return <tt>nil</tt>. Otherwise it will raise error in
synchronous mode. In asynchronous mode this option ignored.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Explicitly choose the decoder for this key (<tt>:plain</tt>,
<tt>:document</tt>, <tt>:marshal</tt>). See <span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:lock</span>
          <span class="type">(<tt>Fixnum</tt>, <tt>Boolean</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
Lock the keys for time span. If this parameter is <tt>true</tt> the key(s)
will be locked for default timeout. Also you can use number to setup your
own timeout in seconds. If it will be lower that zero or exceed the
maximum, the server will use default value. You can determine actual
default and maximum values calling <span class='object_link'><a href="#stats-instance_method" title="Couchbase::Bucket#stats (method)">#stats</a></span> without arguments and
inspecting keys  &#8220;ep_getl_default_timeout&#8221; and
&#8220;ep_getl_max_timeout&#8221; correspondingly. See overloaded hash
syntax to specify custom timeout per each key.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:assemble_hash</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Assemble Hash for results. Hash assembled automatically if
<tt>:extended</tt> option is true or in case of &#8220;get and touch&#8221;
multimple keys.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:replica</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Read key from replica node. Options <tt>:ttl</tt> and <tt>:lock</tt> are
not compatible with <tt>:replica</tt>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>, <tt>value</tt>,
<tt>flags</tt>, <tt>cas</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>Array</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the value(s) (or tuples in extended mode) assiciated with the key.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key is missing in the bucket.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Hash</tt>) <strong>get</strong>(keys, options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
When the method receive hash map, it will behave like it receive list of
keys (<tt>keys.keys</tt>), but also touch each key setting expiry time to
the corresponding value. But unlike usual get this command always return
hash map <tt>{key =&gt; value}</tt> or <tt>{key =&gt; [value, flags, cas]}</tt>.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Get and touch multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; {&quot;foo&quot; =&gt; val1, &quot;bar&quot; =&gt; val2}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Extended get and touch multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; {&quot;foo&quot; =&gt; [val1, flags1, cas1], &quot;bar&quot; =&gt; [val2, flags2, cas2]}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get and lock multiple keys for chosen period in seconds
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='comma'>,</span> <span class='symbol'>:lock</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; {&quot;foo&quot; =&gt; val1, &quot;bar&quot; =&gt; val2}</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Map key-ttl
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation. (see options definition above)
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the values (or tuples in extended mode) assiciated with the keys.
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>


  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><a href="http://couchbase.com/docs/couchbase-manual-2.0/couchbase-architecture-apis-memcached-protocol-additions.html#couchbase-architecture-apis-memcached-protocol-additions-getl" target="_parent" title="http://couchbase.com/docs/couchbase-manual-2.0/couchbase-architecture-apis-memcached-protocol-additions.html#couchbase-architecture-apis-memcached-protocol-additions-getl">http://couchbase.com/docs/couchbase-manual-2.0/couchbase-architecture-apis-memcached-protocol-additions.html#couchbase-architecture-apis-memcached-protocol-additions-getl</a></li>
    
  </ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/get.c', line 214</span>

VALUE
cb_bucket_get(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    struct context_st *ctx;
    VALUE args, rv, proc, exc;
    size_t ii;
    lcb_error_t err = LCB_SUCCESS;
    struct params_st params;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    memset(&amp;params, 0, sizeof(struct params_st));
    params.type = cmd_get;
    params.bucket = bucket;
    params.cmd.get.keys_ary = cb_gc_protect(bucket, rb_ary_new());
    cb_params_build(&amp;params, RARRAY_LEN(args), args);
    ctx = xcalloc(1, sizeof(struct context_st));
    if (ctx == NULL) {
        rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    ctx-&gt;extended = params.cmd.get.extended;
    ctx-&gt;quiet = params.cmd.get.quiet;
    ctx-&gt;force_format = params.cmd.get.forced_format;
    ctx-&gt;proc = cb_gc_protect(bucket, proc);
    ctx-&gt;bucket = bucket;
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;exception = Qnil;
    ctx-&gt;nqueries = params.cmd.get.num;
    if (params.cmd.get.replica) {
        err = lcb_get_replica(bucket-&gt;handle, (const void *)ctx,
                params.cmd.get.num, params.cmd.get.ptr_gr);
    } else {
        err = lcb_get(bucket-&gt;handle, (const void *)ctx,
                params.cmd.get.num, params.cmd.get.ptr);
    }
    cb_params_destroy(&amp;params);
    cb_gc_unprotect(bucket, params.cmd.get.keys_ary);
    exc = cb_check_error(err, &quot;failed to schedule get request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    bucket-&gt;nbytes += params.npayload;
    if (bucket-&gt;async) {
        maybe_do_loop(bucket);
        return Qnil;
    } else {
        if (ctx-&gt;nqueries &gt; 0) {
            /* we have some operations pending */
            lcb_wait(bucket-&gt;handle);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        if (params.cmd.get.gat || params.cmd.get.assemble_hash ||
                (params.cmd.get.extended &amp;&amp; (params.cmd.get.num &gt; 1 || params.cmd.get.array))) {
            return rv;  /* return as a hash {key =&gt; [value, flags, cas], ...} */
        }
        if (params.cmd.get.num &gt; 1 || params.cmd.get.array) {
            VALUE *keys_ptr, ret;
            ret = rb_ary_new();
            keys_ptr = RARRAY_PTR(params.cmd.get.keys_ary);
            for (ii = 0; ii &lt; params.cmd.get.num; ++ii) {
                rb_ary_push(ret, rb_hash_aref(rv, keys_ptr[ii]));
            }
            return ret;  /* return as an array [value1, value2, ...] */
        } else {
            VALUE vv = Qnil;
            rb_hash_foreach(rv, cb_first_value_i, (VALUE)&amp;vv);
            return vv;
        }
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="incr-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>incr</strong>(key, delta = 1, options = {}) {|ret| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='increment-instance_method'>increment</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
that server values stored and transmitted as unsigned numbers, therefore if
you try to store negative number and then increment or decrement it will
cause overflow. (see &#8220;Integer overflow&#8221; example below)
</p>
</div>
  </div>

<p>
Increment the value of an existing numeric key
</p>
<p>
The increment methods allow you to increase a given stored integer value.
These are the incremental equivalent of the decrement operations and work
on the same basis; updating the value of a key if it can be parsed to an
integer. The update operation occurs on the server and is provided at the
protocol level. This simplifies what would otherwise be a two-stage get and
set operation.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The actual value of the key.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key by one
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key by 50
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>50</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key by one <b>OR</b> initialize with zero
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:create</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; will return old+1 or 0</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key by one <b>OR</b> initialize with three
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>50</span><span class='comma'>,</span> <span class='symbol'>:initial</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='rparen'>)</span> <span class='comment'>#=&gt; will return old+50 or 3</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key and get its CAS value
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_cas'>cas</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Integer overflow
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>100</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>           <span class='comment'>#=&gt; -100
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>          <span class='comment'>#=&gt; 18446744073709551517</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous invocation
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :increment
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot;
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>delta</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Integer (up to 64 bits) value to increment
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:create</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, it will initialize the key with zero value and
zero flags (use <tt>:initial</tt> option to set another initial value).
Note: it won&#8217;t increment the missing value.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:initial</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>0</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Integer (up to 64 bits) value for missing key initialization. This option
imply <tt>:create</tt> option is <tt>true</tt>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch). This option ignored for
existent keys.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:extended</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation will return tuple <tt>[value, cas]</tt>,
otherwise (by default) it returns just value.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>, <tt>value</tt>,
<tt>cas</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the actual value of the key.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if key is missing and <tt>:create</tt> option isn&#8217;t <tt>true</tt>.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/DeltaBadval.html" title="Couchbase::Error::DeltaBadval (class)">Couchbase::Error::DeltaBadval</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key contains non-numeric value
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


225
226
227
228
229</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/arithmetic.c', line 225</span>

VALUE
cb_bucket_incr(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_arithmetic(+1, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_copy-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>) <strong>initialize_copy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Initialize copy
</p>
<p>
Initializes copy of the object, used by #dup
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>orig</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the source for copy
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 428</span>

VALUE
cb_bucket_init_copy(VALUE copy, VALUE orig)
{
    struct bucket_st *copy_b;
    struct bucket_st *orig_b;

    if (copy == orig)
        return copy;

    if (TYPE(orig) != T_DATA || TYPE(copy) != T_DATA ||
            RDATA(orig)-&gt;dfree != (RUBY_DATA_FUNC)cb_bucket_free) {
        rb_raise(rb_eTypeError, &quot;wrong argument type&quot;);
    }

    copy_b = DATA_PTR(copy);
    orig_b = DATA_PTR(orig);

    copy_b-&gt;self = copy_b-&gt;self;
    copy_b-&gt;port = orig_b-&gt;port;
    copy_b-&gt;authority = strdup(orig_b-&gt;authority);
    copy_b-&gt;hostname = strdup(orig_b-&gt;hostname);
    copy_b-&gt;pool = strdup(orig_b-&gt;pool);
    copy_b-&gt;bucket = strdup(orig_b-&gt;bucket);
    if (orig_b-&gt;username) {
        copy_b-&gt;username = strdup(orig_b-&gt;username);
    }
    if (orig_b-&gt;password) {
        copy_b-&gt;password = strdup(orig_b-&gt;password);
    }
    if (orig_b-&gt;key_prefix) {
        copy_b-&gt;key_prefix = strdup(orig_b-&gt;key_prefix);
    }
    copy_b-&gt;async = orig_b-&gt;async;
    copy_b-&gt;quiet = orig_b-&gt;quiet;
    copy_b-&gt;default_format = orig_b-&gt;default_format;
    copy_b-&gt;default_flags = orig_b-&gt;default_flags;
    copy_b-&gt;default_ttl = orig_b-&gt;default_ttl;
    copy_b-&gt;environment = orig_b-&gt;environment;
    copy_b-&gt;timeout = orig_b-&gt;timeout;
    copy_b-&gt;exception = Qnil;
    if (orig_b-&gt;on_error_proc != Qnil) {
        copy_b-&gt;on_error_proc = rb_funcall(orig_b-&gt;on_error_proc, id_dup, 0);
    }
    if (orig_b-&gt;key_prefix_val != Qnil) {
        copy_b-&gt;key_prefix_val = rb_funcall(orig_b-&gt;key_prefix_val, id_dup, 0);
    }

    do_connect(copy_b);

    return copy;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    - (<tt>String</tt>) <strong>inspect</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns a string containing a human-readable representation of the
<span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span>.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


895
896
897
898
899
900
901
902
903
904
905
906
907
908
909
910
911
912
913
914
915
916
917
918
919
920
921
922
923
924
925
926
927
928</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 895</span>

VALUE
cb_bucket_inspect(VALUE self)
{
    VALUE str;
    struct bucket_st *bucket = DATA_PTR(self);
    char buf[200];

    str = rb_str_buf_new2(&quot;#&lt;&quot;);
    rb_str_buf_cat2(str, rb_obj_classname(self));
    snprintf(buf, 25, &quot;:%p \&quot;&quot;, (void *)self);
    (void)cb_bucket_authority_get(self);
    rb_str_buf_cat2(str, buf);
    rb_str_buf_cat2(str, &quot;http://&quot;);
    rb_str_buf_cat2(str, bucket-&gt;authority);
    rb_str_buf_cat2(str, &quot;/pools/&quot;);
    rb_str_buf_cat2(str, bucket-&gt;pool);
    rb_str_buf_cat2(str, &quot;/buckets/&quot;);
    rb_str_buf_cat2(str, bucket-&gt;bucket);
    rb_str_buf_cat2(str, &quot;/&quot;);
    snprintf(buf, 150, &quot;\&quot; default_format=:%s, default_flags=0x%x, quiet=%s, connected=%s, timeout=%u&quot;,
            rb_id2name(SYM2ID(bucket-&gt;default_format)),
            bucket-&gt;default_flags,
            bucket-&gt;quiet ? &quot;true&quot; : &quot;false&quot;,
            bucket-&gt;handle ? &quot;true&quot; : &quot;false&quot;,
            bucket-&gt;timeout);
    rb_str_buf_cat2(str, buf);
    if (bucket-&gt;key_prefix) {
        rb_str_buf_cat2(str, &quot;, key_prefix=&quot;);
        rb_str_append(str, rb_inspect(bucket-&gt;key_prefix_val));
    }
    rb_str_buf_cat2(str, &quot;&gt;&quot;);

    return str;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="make_http_request-instance_method">
  
    - (<tt><span class='object_link'><a href="Bucket/CouchRequest.html" title="Couchbase::Bucket::CouchRequest (class)">Couchbase::Bucket::CouchRequest</a></span></tt>) <strong>make_http_request</strong> {|res| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>path</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
    </li>
  
</ul>

  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>res</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Couchbase::Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the response chunk if the :extended option is <tt>false</tt> and result
object otherwise
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Bucket/CouchRequest.html" title="Couchbase::Bucket::CouchRequest (class)">Couchbase::Bucket::CouchRequest</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


391
392
393
394
395
396
397
398
399
400</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/http.c', line 391</span>

VALUE
cb_bucket_make_http_request(int argc, VALUE *argv, VALUE self)
{
    VALUE args[4]; /* bucket, path, options, block */

    args[0] = self;
    rb_scan_args(argc, argv, &quot;11&amp;&quot;, &amp;args[1], &amp;args[2], &amp;args[3]);

    return rb_class_new_instance(4, args, cCouchRequest);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="observe-instance_method">
  
    - (<tt>Hash&lt;String, Array&lt;<span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span>&gt;&gt;</tt>, <tt>Array&lt;<span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span>&gt;</tt>) <strong>observe</strong>(*keys, options = {}) {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Observe key state
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The state of the keys on all nodes. If the <tt>keys</tt> argument was
String or Symbol, this method will return just array of results (result per
each node), otherwise it will return hash map.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Observe single key
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_observe'>observe</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'>#=&gt; [#&lt;Couchbase::Result:0x00000001650df0 ...&gt;, ...]</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Observe multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_keys'>keys</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
<span class='id identifier rubyid_stats'>stats</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_observe'>observe</span><span class='lparen'>(</span><span class='id identifier rubyid_keys'>keys</span><span class='rparen'>)</span>
<span class='id identifier rubyid_stats'>stats</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span>   <span class='comment'>#=&gt; 2
</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='comment'>#=&gt; [#&lt;Couchbase::Result:0x00000001650df0 ...&gt;, ...]</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
One or several keys to fetch
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>status</tt>, <tt>operation</tt>, <tt>key</tt>,
<tt>cas</tt>, <tt>from_master</tt>, <tt>time_to_persist</tt>,
<tt>time_to_replicate</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash&lt;String, Array&lt;<span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span>&gt;&gt;</tt>, <tt>Array&lt;<span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span>&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the state of the keys on all nodes. If the <tt>keys</tt> argument was
String or Symbol, this method will return just array of results (result per
each node), otherwise it will return hash map.
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0.dp6
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/observe.c', line 110</span>

VALUE
cb_bucket_observe(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    struct context_st *ctx;
    VALUE args, rv, proc, exc;
    lcb_error_t err;
    struct params_st params;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    memset(&amp;params, 0, sizeof(struct params_st));
    params.type = cmd_observe;
    params.bucket = bucket;
    cb_params_build(&amp;params, RARRAY_LEN(args), args);
    ctx = xcalloc(1, sizeof(struct context_st));
    if (ctx == NULL) {
        rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    ctx-&gt;proc = cb_gc_protect(bucket, proc);
    ctx-&gt;bucket = bucket;
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;exception = Qnil;
    ctx-&gt;nqueries = params.cmd.observe.num;
    err = lcb_observe(bucket-&gt;handle, (const void *)ctx,
            params.cmd.observe.num, params.cmd.observe.ptr);
    cb_params_destroy(&amp;params);
    exc = cb_check_error(err, &quot;failed to schedule observe request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    bucket-&gt;nbytes += params.npayload;
    if (bucket-&gt;async) {
        maybe_do_loop(bucket);
        return Qnil;
    } else {
        if (ctx-&gt;nqueries &gt; 0) {
            /* we have some operations pending */
            lcb_wait(bucket-&gt;handle);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        if (params.cmd.observe.num &gt; 1 || params.cmd.observe.array) {
            return rv;  /* return as a hash {key =&gt; {}, ...} */
        } else {
            VALUE vv = Qnil;
            rb_hash_foreach(rv, cb_first_value_i, (VALUE)&amp;vv);
            return vv;  /* return first value */
        }
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="observe_and_wait-instance_method">
  
    - (<tt>Fixnum</tt>, <tt>Hash&lt;String, Fixnum&gt;</tt>) <strong>observe_and_wait</strong>(*keys, &amp;block) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Wait for persistence condition
</p>
<p>
This operation is useful when some confidence needed regarding the state of
the keys. With two parameters <tt>:replicated</tt> and <tt>:persisted</tt>
it allows to set up the waiting rule.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>Array</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The list of the keys to observe. Full form is hash with key-cas value
pairs, but there are also shortcuts like just Array of keys or single key.
CAS value needed to when you need to ensure that the storage persisted
exactly the same version of the key you are asking to observe.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The options for operation
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>, <tt>Hash&lt;String, Fixnum&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
will return CAS value just like mutators or pairs key-cas in case of
multiple keys.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Couchbase::Error::Timeout</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the given time is up
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0.dp6
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 291</span>

<span class='kw'>def</span> <span class='id identifier rubyid_observe_and_wait'>observe_and_wait</span><span class='lparen'>(</span><span class='op'>*</span><span class='id identifier rubyid_keys'>keys</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='symbol'>:timeout</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_default_observe_timeout'>default_observe_timeout</span><span class='rbrace'>}</span>
  <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_update'>update</span><span class='lparen'>(</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_verify_observe_options'>verify_observe_options</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block'>block</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_async?'>async?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>synchronous mode doesn't support callbacks</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>0</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>at least one key is required</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_keys'>keys</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_key_cas'>key_cas</span> <span class='op'>=</span> <span class='id identifier rubyid_keys'>keys</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_key_cas'>key_cas</span> <span class='op'>=</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_reduce'>reduce</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='comma'>,</span> <span class='id identifier rubyid_kk'>kk</span><span class='op'>|</span>
      <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='id identifier rubyid_kk'>kk</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='kw'>nil</span>   <span class='comment'># set CAS to nil
</span>      <span class='id identifier rubyid_h'>h</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_async?'>async?</span>
    <span class='id identifier rubyid_do_observe_and_wait'>do_observe_and_wait</span><span class='lparen'>(</span><span class='id identifier rubyid_key_cas'>key_cas</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_res'>res</span> <span class='op'>=</span> <span class='id identifier rubyid_do_observe_and_wait'>do_observe_and_wait</span><span class='lparen'>(</span><span class='id identifier rubyid_key_cas'>key_cas</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span> <span class='kw'>while</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_async?'>async?</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>==</span> <span class='int'>1</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_keys'>keys</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>String</span><span class='rparen'>)</span> <span class='op'>||</span> <span class='id identifier rubyid_keys'>keys</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_is_a?'>is_a?</span><span class='lparen'>(</span><span class='const'>Symbol</span><span class='rparen'>)</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
      <span class='kw'>else</span>
        <span class='kw'>return</span> <span class='id identifier rubyid_res'>res</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prepend-instance_method">
  
    - (<tt>Object</tt>) <strong>prepend</strong>(key, value, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
This operation is kind of data-aware from server point of view. This mean
that the server treats value as binary stream and just perform
concatenation, therefore it won&#8217;t work with <tt>:marshal</tt> and
<tt>:document</tt> formats, because of lack of knowledge how to merge
values in these formats. See <span class='object_link'><a href="#cas-instance_method" title="Couchbase::Bucket#cas (method)">#cas</a></span> for workaround.
</p>
</div>
  </div>

<p>
Prepend this object to the existing object
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Simple prepend example
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_prepend'>prepend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bbb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>           <span class='comment'>#=&gt; &quot;bbbaaa&quot;</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Using explicit format option
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_default_format'>default_format</span>       <span class='comment'>#=&gt; :document
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>y</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>z</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_prepend'>prepend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:plain</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>, {&quot;z&quot;: &quot;y&quot;}]</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:plain</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>           <span class='comment'>#=&gt; [{&quot;y&quot;=&gt;&quot;z&quot;}, {&quot;z&quot;=&gt;&quot;y&quot;}]</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Using optimistic locking. The operation will fail on CAS mismatch
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_ver'>ver</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_prepend'>prepend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bbb</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ver'>ver</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Ensure that the key will be persisted at least on the one node
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_prepend'>prepend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:observe</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:persisted</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:observe</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
Apply persistence condition before returning result. When this option
specified the library will observe given condition. See
<span class='object_link'><a href="#observe_and_wait-instance_method" title="Couchbase::Bucket#observe_and_wait (method)">#observe_and_wait</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
on CAS mismatch
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotStored.html" title="Couchbase::Error::NotStored (class)">Couchbase::Error::NotStored</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key doesn&#8217;t exist
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Couchbase::Error::Timeout</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if timeout interval for observe exceeds
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


502
503
504
505
506</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/store.c', line 502</span>

VALUE
cb_bucket_prepend(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LCB_PREPEND, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reconnect-instance_method">
  
    
      <span class="overload">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>) <strong>reconnect</strong>(url, options = {}) </span>
    
      <span class="overload">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>) <strong>reconnect</strong>(options = {}) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Reconnect the bucket
</p>
<p>
Reconnect the bucket using initial configuration with optional
redefinition.
</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>) <strong>reconnect</strong>(url, options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
see <span class='object_link'><a href="#initialize-instance_method" title="Couchbase::Bucket#initialize (method)">Bucket#initialize(url, options)</a></span>
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>) <strong>reconnect</strong>(options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
see <span class='object_link'><a href="#initialize-instance_method" title="Couchbase::Bucket#initialize (method)">Bucket#initialize(options)</a></span>
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
reconnect with current parameters
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_reconnect'>reconnect</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
reconnect the instance to another bucket
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_reconnect'>reconnect</span><span class='lparen'>(</span><span class='symbol'>:bucket</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>new</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.1.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


502
503
504
505
506
507
508
509
510
511</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 502</span>

VALUE
cb_bucket_reconnect(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);

    do_scan_connection_options(bucket, argc, argv);
    do_connect(bucket);

    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="replace-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>replace</strong>(key, value, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Replace the existing object in the database
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The CAS value of the object.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Replacing missing key
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; will raise Couchbase::Error::NotFound: failed to store value (key=&quot;foo&quot;, error=0x0d)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Ensure that the key will be persisted at least on the one node
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:observe</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:persisted</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_flags</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Flags for storage options. Flags are ignored by the server but preserved
for use by the client. For more info see <span class='object_link'><a href="#default_flags-instance_method" title="Couchbase::Bucket#default_flags (method)">#default_flags</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:observe</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
Apply persistence condition before returning result. When this option
specified the library will observe given condition. See
<span class='object_link'><a href="#observe_and_wait-instance_method" title="Couchbase::Bucket#observe_and_wait (method)">#observe_and_wait</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CAS value of the object.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key doesn&#8217;t exists
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
on CAS mismatch
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Couchbase::Error::Timeout</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if timeout interval for observe exceeds
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


363
364
365
366
367</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/store.c', line 363</span>

VALUE
cb_bucket_replace(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LCB_REPLACE, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run-instance_method">
  
    - (<tt>nil</tt>) <strong>run</strong> {|bucket| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Run the event loop.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Use block to run the loop
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use lambda to run the loop
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_operations'>operations</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_operations'>operations</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use threshold to send out commands automatically
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span>
<span class='id identifier rubyid_sent'>sent</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='symbol'>:send_threshold</span> <span class='op'>=&gt;</span> <span class='int'>8192</span><span class='rparen'>)</span> <span class='kw'>do</span>  <span class='comment'># 8Kb
</span>  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo1</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>100</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_sent'>sent</span> <span class='op'>+=</span> <span class='int'>1</span><span class='rbrace'>}</span>
  <span class='comment'># 128 bytes buffered, sent is 0 now
</span>  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo2</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>10000</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_sent'>sent</span> <span class='op'>+=</span> <span class='int'>1</span><span class='rbrace'>}</span>
  <span class='comment'># 10028 bytes added, sent is 2 now
</span>  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo3</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>x</span><span class='tstring_end'>&quot;</span></span> <span class='op'>*</span> <span class='int'>100</span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_r'>r</span><span class='op'>|</span> <span class='id identifier rubyid_sent'>sent</span> <span class='op'>+=</span> <span class='int'>1</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
<span class='comment'># all commands were executed and sent is 3 now</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The options for operation for connection
</p>
</div>
      
    </li>
  
</ul>

  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>bucket</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the bucket instance
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 1029</span>

VALUE
cb_bucket_run(int argc, VALUE *argv, VALUE self)
{
    VALUE args[3];

    rb_need_block();
    args[0] = self;
    rb_scan_args(argc, argv, &quot;01&amp;&quot;, &amp;args[1], &amp;args[2]);
    rb_ensure(do_run, (VALUE)args, ensure_run, (VALUE)args);
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="save_design_doc-instance_method">
  
    - (<tt>true</tt>, <tt>false</tt>) <strong>save_design_doc</strong>(data) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Update or create design doc with supplied views
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>data</span>
      
      
        <span class='type'>(<tt>Hash</tt>, <tt>IO</tt>, <tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The source object containing JSON encoded design document. It must have
<tt>_id</tt> key set, this key should start with <tt>_design/</tt>.
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 140</span>

<span class='kw'>def</span> <span class='id identifier rubyid_save_design_doc'>save_design_doc</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_attrs'>attrs</span> <span class='op'>=</span> <span class='kw'>case</span> <span class='id identifier rubyid_data'>data</span>
          <span class='kw'>when</span> <span class='const'>String</span>
            <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
          <span class='kw'>when</span> <span class='const'>IO</span>
            <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='rparen'>)</span>
          <span class='kw'>when</span> <span class='const'>Hash</span>
            <span class='id identifier rubyid_data'>data</span>
          <span class='kw'>else</span>
            <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ArgumentError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Document should be Hash, String or IO instance</span><span class='tstring_end'>&quot;</span></span>
          <span class='kw'>end</span>
  <span class='id identifier rubyid_rv'>rv</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='id identifier rubyid_id'>id</span> <span class='op'>=</span> <span class='id identifier rubyid_attrs'>attrs</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>_id</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='id identifier rubyid_attrs'>attrs</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>language</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>javascript</span><span class='tstring_end'>'</span></span>
  <span class='kw'>if</span> <span class='id identifier rubyid_id'>id</span> <span class='op'>!~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A_design\/</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_rv'>rv</span> <span class='op'>=</span> <span class='const'>Result</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:operation</span> <span class='op'>=&gt;</span> <span class='symbol'>:http_request</span><span class='comma'>,</span>
                    <span class='symbol'>:key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_id'>id</span><span class='comma'>,</span>
                    <span class='symbol'>:error</span> <span class='op'>=&gt;</span> <span class='const'>ArgumentError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>'_id' key must be set and start with '_design/'.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>yield</span> <span class='id identifier rubyid_rv'>rv</span> <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_rv'>rv</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='kw'>unless</span> <span class='id identifier rubyid_async?'>async?</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_req'>req</span> <span class='op'>=</span> <span class='id identifier rubyid_make_http_request'>make_http_request</span><span class='lparen'>(</span><span class='id identifier rubyid_id'>id</span><span class='comma'>,</span> <span class='symbol'>:body</span> <span class='op'>=&gt;</span> <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_dump'>dump</span><span class='lparen'>(</span><span class='id identifier rubyid_attrs'>attrs</span><span class='rparen'>)</span><span class='comma'>,</span>
                          <span class='symbol'>:method</span> <span class='op'>=&gt;</span> <span class='symbol'>:put</span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_on_body'>on_body</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_res'>res</span><span class='op'>|</span>
    <span class='id identifier rubyid_rv'>rv</span> <span class='op'>=</span> <span class='id identifier rubyid_res'>res</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='const'>MultiJson</span><span class='period'>.</span><span class='id identifier rubyid_load'>load</span><span class='lparen'>(</span><span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>error</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span>
        <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span> <span class='op'>=</span> <span class='const'>Error</span><span class='op'>::</span><span class='const'>View</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>save_design_doc</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>error</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
      <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_res'>res</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_req'>req</span><span class='period'>.</span><span class='id identifier rubyid_continue'>continue</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_async?'>async?</span>
    <span class='id identifier rubyid_rv'>rv</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span> <span class='kw'>or</span> <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_res'>res</span><span class='period'>.</span><span class='id identifier rubyid_error'>error</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>set</strong>(key, value, options = {}) {|ret| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='[]=-instance_method'>[]=</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Unconditionally store the object in the Couchbase
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The CAS value of the object.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Store the key which will be expired in 2 seconds using relative TTL.
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:ttl</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Store the key which will be expired in 2 seconds using absolute TTL.
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:ttl</span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>+</span> <span class='int'>2</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Force JSON document format for value
</p>
</div></p>
      
      <pre class="example code">c.set(&quot;foo&quot;, {&quot;bar&quot; =&gt; &quot;baz}, :format =&gt; :document)</pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use hash-like syntax to store the value
</p>
</div></p>
      
      <pre class="example code">c.set[&quot;foo&quot;] = {&quot;bar&quot; =&gt; &quot;baz}</pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use extended hash-like syntax
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='int'>0x1000</span><span class='comma'>,</span> <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:plain</span><span class='rbrace'>}</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_c'>c</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='int'>0x1000</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>  <span class='comment'># for ruby 1.9.x only</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Set application specific flags (note that it will be OR-ed with format
flags)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='int'>0x1000</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Perform optimistic locking by specifying last known CAS version
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='int'>8835713818674332672</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Perform asynchronous call
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :set
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot;
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Ensure that the key will be persisted at least on the one node
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:observe</span> <span class='op'>=&gt;</span> <span class='lbrace'>{</span><span class='symbol'>:persisted</span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_flags</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Flags for storage options. Flags are ignored by the server but preserved
for use by the client. For more info see <span class='object_link'><a href="#default_flags-instance_method" title="Couchbase::Bucket#default_flags (method)">#default_flags</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:observe</span>
          <span class="type">(<tt>Hash</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
Apply persistence condition before returning result. When this option
specified the library will observe given condition. See
<span class='object_link'><a href="#observe_and_wait-instance_method" title="Couchbase::Bucket#observe_and_wait (method)">#observe_and_wait</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CAS value of the object.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>).
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key already exists on the server.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/ValueFormat.html" title="Couchbase::Error::ValueFormat (class)">Couchbase::Error::ValueFormat</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the value cannot be serialized with chosen encoder, e.g. if you try to
store the Hash in <tt>:plain</tt> mode.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Couchbase::Error::Timeout</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if timeout interval for observe exceeds
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


259
260
261
262
263</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/store.c', line 259</span>

VALUE
cb_bucket_set(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LCB_SET, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stats-instance_method">
  
    - (<tt>Hash</tt>) <strong>stats</strong>(arg = nil) {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Request server statistics.
</p>
<p>
Fetches stats from each node in cluster. Without a key specified the server
will respond with a &#8220;default&#8221; set of statistical information.
In asynchronous mode each statistic is returned in separate call where the
Result object yielded (<tt>#key</tt> contains the name of the statistical
item and the <tt>#value</tt> contains the value, the <tt>#node</tt> will
indicate the server address). In synchronous mode it returns the hash of
stats keys and node-value pairs as a value.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
Where keys are stat keys, values are host-value pairs
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Found how many items in the bucket
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total_items</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
  <span class='id identifier rubyid_total'>total</span> <span class='op'>+=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Found total items number asynchronously
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total_items</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_total'>total</span> <span class='op'>+=</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get memory stats (works on couchbase buckets)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='lparen'>(</span><span class='symbol'>:memory</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; {&quot;mem_used&quot;=&gt;{...}, ...}</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>arg</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
argument to STATS query
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the object with <tt>node</tt>, <tt>key</tt> and <tt>value</tt> attributes.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
where keys are stat keys, values are host-value pairs
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/stats.c', line 107</span>

VALUE
cb_bucket_stats(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    struct context_st *ctx;
    VALUE rv, exc, args, proc;
    lcb_error_t err;
    struct params_st params;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    memset(&amp;params, 0, sizeof(struct params_st));
    params.type = cmd_stats;
    params.bucket = bucket;
    cb_params_build(&amp;params, RARRAY_LEN(args), args);
    ctx = xcalloc(1, sizeof(struct context_st));
    if (ctx == NULL) {
        rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;bucket = bucket;
    ctx-&gt;proc = cb_gc_protect(bucket, proc);
    ctx-&gt;exception = Qnil;
    ctx-&gt;nqueries = params.cmd.stats.num;
    err = lcb_server_stats(bucket-&gt;handle, (const void *)ctx,
            params.cmd.stats.num, params.cmd.stats.ptr);
    exc = cb_check_error(err, &quot;failed to schedule stat request&quot;, Qnil);
    cb_params_destroy(&amp;params);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    bucket-&gt;nbytes += params.npayload;
    if (bucket-&gt;async) {
        maybe_do_loop(bucket);
        return Qnil;
    } else {
        if (ctx-&gt;nqueries &gt; 0) {
            /* we have some operations pending */
            lcb_wait(bucket-&gt;handle);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        return rv;
    }

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop-instance_method">
  
    - (<tt>nil</tt>) <strong>stop</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Stop the event loop.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Breakout the event loop when 5th request is completed
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='int'>10</span><span class='period'>.</span><span class='id identifier rubyid_times'>times</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ii'>ii</span><span class='op'>|</span>
    <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ii'>ii</span>
      <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_stop'>stop</span> <span class='kw'>if</span> <span class='id identifier rubyid_ii'>ii</span> <span class='op'>==</span> <span class='int'>5</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1059
1060
1061
1062
1063
1064
1065</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/bucket.c', line 1059</span>

VALUE
cb_bucket_stop(VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    bucket-&gt;io-&gt;stop_event_loop(bucket-&gt;io);
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="touch-instance_method">
  
    
      <span class="overload">- (<tt>true</tt>, <tt>false</tt>) <strong>touch</strong>(key, options = {}) {|ret| ... }</span>
    
      <span class="overload">- (<tt>Hash</tt>) <strong>touch</strong>(keys) {|ret| ... }</span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Update the expiry time of an item
</p>
<p>
The <tt>touch</tt> method allow you to update the expiration time on a
given key. This can be useful for situations where you want to prevent an
item from expiring without resetting the associated value. For example, for
a session database you might want to keep the session alive in the database
each time the user accesses a web page without explicitly updating the
session value, keeping the user&#8217;s session active and available.
</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>true</tt>, <tt>false</tt>) <strong>touch</strong>(key, options = {}) {|ret| ... }</span>
        <div class="docstring">
  <div class="discussion">
    <p>
<tt>true</tt> if the operation was successful and <tt>false</tt> otherwise.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Touch value using <tt>default_ttl</tt>
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Touch value using custom TTL (10 seconds)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:ttl</span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:quiet</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.quiet</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation won&#8217;t raise error for missing
key, it will return <tt>nil</tt>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<tt>true</tt> if the operation was successful and <tt>false</tt> otherwise.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Hash</tt>) <strong>touch</strong>(keys) {|ret| ... }</span>
        <div class="docstring">
  <div class="discussion">
    <p>
Mapping keys to result of touch operation (<tt>true</tt> if the operation
was successful and <tt>false</tt> otherwise)
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Touch several values
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='symbol'>:bar</span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rparen'>)</span> <span class='comment'>#=&gt; {&quot;foo&quot; =&gt; true, &quot;bar&quot; =&gt; true}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Touch several values in async mode
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='symbol'>:bar</span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :touch
</span>     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot; and &quot;bar&quot; in separate calls
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Touch single value
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='rparen'>)</span>             <span class='comment'>#=&gt; true</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The Hash where keys represent the keys in the database, values &#8212; the
expiry times for corresponding key. See description of <tt>:ttl</tt>
argument above for more information about TTL values.
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation for each key in asynchronous mode (valid
attributes: <tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Mapping keys to result of touch operation (<tt>true</tt> if the operation
was successful and <tt>false</tt> otherwise)
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.0.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/touch.c', line 123</span>

VALUE
cb_bucket_touch(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    struct context_st *ctx;
    VALUE args, rv, proc, exc;
    lcb_error_t err;
    struct params_st params;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    rb_funcall(args, id_flatten_bang, 0);
    memset(&amp;params, 0, sizeof(struct params_st));
    params.type = cmd_touch;
    params.bucket = bucket;
    cb_params_build(&amp;params, RARRAY_LEN(args), args);
    ctx = xcalloc(1, sizeof(struct context_st));
    if (ctx == NULL) {
        rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    ctx-&gt;proc = cb_gc_protect(bucket, proc);
    ctx-&gt;bucket = bucket;
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;exception = Qnil;
    ctx-&gt;quiet = params.cmd.touch.quiet;
    ctx-&gt;nqueries = params.cmd.touch.num;
    err = lcb_touch(bucket-&gt;handle, (const void *)ctx,
            params.cmd.touch.num, params.cmd.touch.ptr);
    cb_params_destroy(&amp;params);
    exc = cb_check_error(err, &quot;failed to schedule touch request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    bucket-&gt;nbytes += params.npayload;
    if (bucket-&gt;async) {
        maybe_do_loop(bucket);
        return Qnil;
    } else {
        if (ctx-&gt;nqueries &gt; 0) {
            /* we have some operations pending */
            lcb_wait(bucket-&gt;handle);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            rb_exc_raise(cb_gc_unprotect(bucket, exc));
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        if (params.cmd.touch.num &gt; 1) {
            return rv;  /* return as a hash {key =&gt; true, ...} */
        } else {
            VALUE vv = Qnil;
            rb_hash_foreach(rv, cb_first_value_i, (VALUE)&amp;vv);
            return vv;
        }
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="unlock-instance_method">
  
    
      <span class="overload">- (<tt>true</tt>, <tt>false</tt>) <strong>unlock</strong>(key, options = {}) </span>
    
      <span class="overload">- (<tt>Hash</tt>) <strong>unlock</strong>(keys) {|ret| ... }</span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Unlock key
</p>
<p>
The <tt>unlock</tt> method allow you to unlock key once locked by
<span class='object_link'><a href="#get-instance_method" title="Couchbase::Bucket#get (method)">#get</a></span> with <tt>:lock</tt> option.
</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>true</tt>, <tt>false</tt>) <strong>unlock</strong>(key, options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
<tt>true</tt> if the operation was successful and <tt>false</tt> otherwise.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Unlock the single key
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='comma'>,</span> <span class='id identifier rubyid_cas'>cas</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:lock</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cas'>cas</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value must match the current one from the storage.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:quiet</span>
          <span class="type">(<tt>true</tt>, <tt>false</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.quiet</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation won&#8217;t raise error for missing
key, it will return <tt>nil</tt>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>, <tt>false</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<tt>true</tt> if the operation was successful and <tt>false</tt> otherwise.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if key(s) not found in the storage
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/TemporaryFail.html" title="Couchbase::Error::TemporaryFail (class)">Couchbase::Error::TemporaryFail</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if either the key wasn&#8217;t locked or given CAS value doesn&#8217;t
match to actual in the storage
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Hash</tt>) <strong>unlock</strong>(keys) {|ret| ... }</span>
        <div class="docstring">
  <div class="discussion">
    <p>
Mapping keys to result of unlock operation (<tt>true</tt> if the operation
was successful and <tt>false</tt> otherwise)
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Unlock several keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cas1'>cas1</span><span class='comma'>,</span> <span class='symbol'>:bar</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_cas2'>cas2</span><span class='rparen'>)</span> <span class='comment'>#=&gt; {&quot;foo&quot; =&gt; true, &quot;bar&quot; =&gt; true}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Unlock several values in async mode
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_unlock'>unlock</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='symbol'>:bar</span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :unlock
</span>     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot; and &quot;bar&quot; in separate calls
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The Hash where keys represent the keys in the database, values &#8212; the
CAS for corresponding key.
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation for each key in asynchronous mode (valid
attributes: <tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Mapping keys to result of unlock operation (<tt>true</tt> if the operation
was successful and <tt>false</tt> otherwise)
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.2.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/unlock.c', line 113</span>

VALUE
cb_bucket_unlock(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    struct context_st *ctx;
    VALUE args, rv, proc, exc;
    lcb_error_t err;
    struct params_st params;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    rb_funcall(args, id_flatten_bang, 0);
    memset(&amp;params, 0, sizeof(struct params_st));
    params.type = cmd_unlock;
    params.bucket = bucket;
    cb_params_build(&amp;params, RARRAY_LEN(args), args);
    ctx = xcalloc(1, sizeof(struct context_st));
    if (ctx == NULL) {
        rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    ctx-&gt;proc = cb_gc_protect(bucket, proc);
    ctx-&gt;bucket = bucket;
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;exception = Qnil;
    ctx-&gt;quiet = params.cmd.unlock.quiet;
    ctx-&gt;nqueries = params.cmd.unlock.num;
    err = lcb_unlock(bucket-&gt;handle, (const void *)ctx,
            params.cmd.unlock.num, params.cmd.unlock.ptr);
    cb_params_destroy(&amp;params);
    exc = cb_check_error(err, &quot;failed to schedule unlock request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    bucket-&gt;nbytes += params.npayload;
    if (bucket-&gt;async) {
        maybe_do_loop(bucket);
        return Qnil;
    } else {
        if (ctx-&gt;nqueries &gt; 0) {
            /* we have some operations pending */
            lcb_wait(bucket-&gt;handle);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            rb_exc_raise(cb_gc_unprotect(bucket, exc));
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        if (params.cmd.unlock.num &gt; 1) {
            return rv;  /* return as a hash {key =&gt; true, ...} */
        } else {
            VALUE vv = Qnil;
            rb_hash_foreach(rv, cb_first_value_i, (VALUE)&amp;vv);
            return vv;
        }
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="version-instance_method">
  
    - (<tt>Hash</tt>) <strong>version</strong> {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns versions of the server for each node in the cluster
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
Node-version pairs
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Synchronous version request
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span>            <span class='comment'>#=&gt; will render version</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous version request
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>    <span class='comment'>#=&gt; :version
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>     <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_node'>node</span>         <span class='comment'>#=&gt; &quot;localhost:11211&quot;
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>        <span class='comment'>#=&gt; will render version
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the object with <tt>error</tt>, <tt>node</tt>, <tt>operation</tt> and
<tt>value</tt> attributes.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
node-version pairs
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>

<p class="tag_title">Since:</p>
<ul class="since">
  
    <li>
      
      
      
      
        
        <div class='inline'><p>
1.1.0
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/version.c', line 87</span>

VALUE
cb_bucket_version(int argc, VALUE *argv, VALUE self)
{
    struct bucket_st *bucket = DATA_PTR(self);
    struct context_st *ctx;
    VALUE rv, exc, args, proc;
    lcb_error_t err;
    struct params_st params;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    memset(&amp;params, 0, sizeof(struct params_st));
    params.type = cmd_version;
    params.bucket = bucket;
    cb_params_build(&amp;params, RARRAY_LEN(args), args);
    ctx = xcalloc(1, sizeof(struct context_st));
    if (ctx == NULL) {
        rb_raise(eClientNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;bucket = bucket;
    ctx-&gt;exception = Qnil;
    ctx-&gt;proc = cb_gc_protect(bucket, proc);
    ctx-&gt;nqueries = params.cmd.version.num;
    err = lcb_server_versions(bucket-&gt;handle, (const void *)ctx,
            params.cmd.version.num, params.cmd.version.ptr);
    exc = cb_check_error(err, &quot;failed to schedule version request&quot;, Qnil);
    cb_params_destroy(&amp;params);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    bucket-&gt;nbytes += params.npayload;
    if (bucket-&gt;async) {
        maybe_do_loop(bucket);
        return Qnil;
    } else {
        if (ctx-&gt;nqueries &gt; 0) {
            /* we have some operations pending */
            lcb_wait(bucket-&gt;handle);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        return rv;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Sep 18 17:48:23 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.9.2).
</div>

  </body>
</html>