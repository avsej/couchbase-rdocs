<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Couchbase::Bucket
  
    &mdash; Documentation by YARD 0.8.2.1
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" media="screen" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!" + escape(window.location.href);
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (B)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Couchbase.html" title="Couchbase (module)">Couchbase</a></span></span>
     &raquo; 
    <span class="title">Bucket</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Couchbase::Bucket
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Couchbase::Bucket</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">ext/couchbase_ext/couchbase_ext.c<span class="defines">,<br />
  lib/couchbase/bucket.rb,<br /> ext/couchbase_ext/couchbase_ext.c</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    <p>
This class in charge of all stuff connected to communication with
Couchbase.
</p>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="FMT_MASK-constant" class="">FMT_MASK =
          <div class="docstring">
  <div class="discussion">
    <p>
Bitmask for flag bits responsible for format
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x03</span></pre></dd>
      
        <dt id="FMT_DOCUMENT-constant" class="">FMT_DOCUMENT =
          <div class="docstring">
  <div class="discussion">
    <p>
Document format. The (default) format supports most of ruby types which
could be mapped to JSON data (hashes, arrays, strings, numbers). Future
version will be able to run map/reduce queries on the values in the
document form (hashes).
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x00</span></pre></dd>
      
        <dt id="FMT_MARSHAL-constant" class="">FMT_MARSHAL =
          <div class="docstring">
  <div class="discussion">
    <p>
Marshal format. The format which supports transparent serialization of ruby
objects with standard <tt>Marshal.dump</tt> and <tt>Marhal.load</tt>
methods.
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x01</span></pre></dd>
      
        <dt id="FMT_PLAIN-constant" class="">FMT_PLAIN =
          <div class="docstring">
  <div class="discussion">
    <p>
Plain format. The format which force client don&#8217;t apply any
conversions to the value, but it should be passed as String. It could be
useful for building custom algorithms or formats. For example implement
set: <a
href="http://dustin.github.com/2011/02/17/memcached-set.html">dustin.github.com/2011/02/17/memcached-set.html</a>
</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='int'>0x02</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#authority-instance_method" title="#authority (instance method)">- (String) <strong>authority</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#bucket-instance_method" title="#bucket (instance method)">- (String) <strong>bucket</strong> </a>
    

    
      (also: #name)
    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_flags-instance_method" title="#default_flags (instance method)">- (Fixnum) <strong>default_flags</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Default flags for new values.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#default_format-instance_method" title="#default_format (instance method)">- (Symbol) <strong>default_format</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Default format for new values.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#hostname-instance_method" title="#hostname (instance method)">- (String) <strong>hostname</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#on_error-instance_method" title="#on_error (instance method)">- (Proc) <strong>on_error</strong> {|op, key, exc| ... }</a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Error callback for asynchronous mode.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#password-instance_method" title="#password (instance method)">- (String) <strong>password</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#pool-instance_method" title="#pool (instance method)">- (String) <strong>pool</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#port-instance_method" title="#port (instance method)">- (Fixnum) <strong>port</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#quiet-instance_method" title="#quiet (instance method)">- (Boolean) <strong>quiet</strong> </a>
    

    
      (also: #quiet?)
    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Flag specifying behaviour for operations on missing keys.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#seqno-instance_method" title="#seqno (instance method)">- (Object) <strong>seqno</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
The number of scheduled commands.
</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#timeout-instance_method" title="#timeout (instance method)">- (Fixnum) <strong>timeout</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#url-instance_method" title="#url (instance method)">- (String) <strong>url</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#username-instance_method" title="#username (instance method)">- (String) <strong>username</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#add-instance_method" title="#add (instance method)">- (Fixnum) <strong>add</strong>(key, value, options = {}) {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Add the item to the database, but fail if the object exists already.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#append-instance_method" title="#append (instance method)">- (Fixnum) <strong>append</strong>(key, value, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Append this object to the existing object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#async%3F-instance_method" title="#async? (instance method)">- (Boolean) <strong>async?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Check whether the connection asynchronous.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cas-instance_method" title="#cas (instance method)">- (Fixnum) <strong>cas</strong>(key, options = {}) {|value| ... }</a>
    

    
      (also: #compare_and_swap)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Reads a key&#8217;s value from the server and yields it to a block.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connected%3F-instance_method" title="#connected? (instance method)">- (Boolean) <strong>connected?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Check whether the instance connected to the cluster.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#decr-instance_method" title="#decr (instance method)">- (Fixnum) <strong>decr</strong>(key, delta = 1, options = {}) {|ret| ... }</a>
    

    
      (also: #decrement)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Decrement the value of an existing numeric key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#delete-instance_method" title="#delete (instance method)">- (Object) <strong>delete</strong>(key, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Delete the specified key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#disconnect-instance_method" title="#disconnect (instance method)">- (true) <strong>disconnect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Close the connection to the cluster.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush-instance_method" title="#flush (instance method)">- (Boolean) <strong>flush</strong> {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Deletes all values from a server.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get-instance_method" title="#get (instance method)">- (Object) <strong>get</strong> </a>
    

    
      (also: #[])
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Obtain an object stored in Couchbase by given key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#incr-instance_method" title="#incr (instance method)">- (Fixnum) <strong>incr</strong>(key, delta = 1, options = {}) {|ret| ... }</a>
    

    
      (also: #increment)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Increment the value of an existing numeric key.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Bucket) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Initialize new Bucket.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize_copy-instance_method" title="#initialize_copy (instance method)">- (Couchbase::Bucket) <strong>initialize_copy</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Initialize copy.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">- (String) <strong>inspect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns a string containing a human-readable representation of the Bucket.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#prepend-instance_method" title="#prepend (instance method)">- (Object) <strong>prepend</strong>(key, value, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Prepend this object to the existing object.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reconnect-instance_method" title="#reconnect (instance method)">- (Object) <strong>reconnect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Reconnect the bucket.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#replace-instance_method" title="#replace (instance method)">- (Fixnum) <strong>replace</strong>(key, value, options = {}) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Replace the existing object in the database.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run-instance_method" title="#run (instance method)">- (nil) <strong>run</strong> {|bucket| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Run the event loop.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set-instance_method" title="#set (instance method)">- (Fixnum) <strong>set</strong>(key, value, options = {}) {|ret| ... }</a>
    

    
      (also: #[]=)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Unconditionally store the object in the Couchbase.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stats-instance_method" title="#stats (instance method)">- (Hash) <strong>stats</strong>(arg = nil) {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Request server statistics.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#touch-instance_method" title="#touch (instance method)">- (Object) <strong>touch</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Update the expiry time of an item.
</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#version-instance_method" title="#version (instance method)">- (Hash) <strong>version</strong> {|ret| ... }</a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>
Returns versions of the server for each node in the cluster.
</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    
      <span class="overload">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>) <strong>initialize</strong>(url, options = {}) </span>
    
      <span class="overload">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>) <strong>initialize</strong>(options = {}) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Initialize new Bucket.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Initialize connection using default options
</p>
</div></p>
      
      <pre class="example code"><span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Select custom bucket
</p>
</div></p>
      
      <pre class="example code"><span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:bucket</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>foo</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://localhost:8091/pools/default/buckets/foo</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Connect to protected bucket
</p>
</div></p>
      
      <pre class="example code"><span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:bucket</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>protected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:username</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>protected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:password</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>secret</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span>
<span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>http://localhost:8091/pools/default/buckets/protected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span>
              <span class='symbol'>:username</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>protected</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:password</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>secret</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use list of nodes, in case some nodes might be dead
</p>
</div></p>
      
      <pre class="example code"><span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='symbol'>:node_list</span> <span class='op'>=&gt;</span> <span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>example.com:8091</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>example.org:8091</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>example.net</span><span class='tstring_end'>'</span></span><span class='rbracket'>]</span><span class='rparen'>)</span></pre>
    
  </div>

  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>) <strong>initialize</strong>(url, options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
Initialize bucket using URI of the cluster and options. It is possible to
override some parts of URI using the options keys (e.g. :host or :port)
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>url</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The full URL of management API of the cluster.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The options for connection. See options definition below.
</p>
</div>
      
    </li>
  
</ul>


</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>) <strong>initialize</strong>(options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
Initialize bucket using options only.
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The options for operation for connection
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:node_list</span>
          <span class="type">(<tt>Array</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the list of nodes to connect to. If specified it takes precedence over
<tt>:host</tt> option. The list must be array of strings in form of host
names or host names with ports (in first case port 8091 will be used, see
examples).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:host</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;localhost&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the hostname or IP address of the node
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:port</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>8091</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the port of the managemenent API
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:pool</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;default&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the pool name
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:bucket</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>&quot;default&quot;</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the bucket name
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:default_ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>0</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the TTL used by default during storing key-value pairs.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:default_flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>0</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the default flags.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:default_format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>:document</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the format, which will be used for values by default. Note that changing
format will amend flags. (see <span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>)
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:username</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the user name to connect to the cluster. Used to authenticate on management
API.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:password</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the password of the user.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:quiet</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>true</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the flag controlling if raising exception when the client executes
operations on unexising keys. If it is <tt>true</tt> it will raise
<span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Error::NotFound</a></span> exceptions. The default behaviour is to return
<tt>nil</tt> value silently (might be useful in Rails cache).
</p>
</div>
          
        </li>
      
    </ul>
  


</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1321</span>

static VALUE
cb_bucket_init(int argc, VALUE *argv, VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);

    bucket-&gt;exception = Qnil;
    bucket-&gt;hostname = strdup(&quot;localhost&quot;);
    bucket-&gt;port = 8091;
    bucket-&gt;pool = strdup(&quot;default&quot;);
    bucket-&gt;bucket = strdup(&quot;default&quot;);
    bucket-&gt;async = 0;
    bucket-&gt;quiet = 1;
    bucket-&gt;default_ttl = 0;
    bucket-&gt;default_flags = 0;
    bucket-&gt;default_format = sym_document;
    bucket-&gt;on_error_proc = Qnil;
    bucket-&gt;timeout = 0;
    bucket-&gt;object_space = rb_hash_new();
    bucket-&gt;node_list = NULL;

    do_scan_connection_options(bucket, argc, argv);
    do_connect(bucket);

    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="authority-instance_method">
  
    - (<tt>String</tt>) <strong>authority</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Host with port
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
host with port
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632
1633</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1618</span>

static VALUE
cb_bucket_authority_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    size_t len;

    (void)cb_bucket_hostname_get(self);
    (void)cb_bucket_port_get(self);
    len = strlen(bucket-&gt;hostname) + 10;
    bucket-&gt;authority = xcalloc(len, sizeof(char));
    if (bucket-&gt;authority == NULL) {
        rb_raise(eNoMemoryError, &quot;failed to allocate memory for Bucket&quot;);
    }
    snprintf(bucket-&gt;authority, len, &quot;%s:%u&quot;, bucket-&gt;hostname, bucket-&gt;port);
    return STR_NEW_CSTR(bucket-&gt;authority);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="bucket-instance_method">
  
    - (<tt>String</tt>) <strong>bucket</strong>  <span class="extras">(readonly)</span>
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='name-instance_method'>name</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The bucket name
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the bucket name
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1638
1639
1640
1641
1642
1643</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1638</span>

static VALUE
cb_bucket_bucket_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return STR_NEW_CSTR(bucket-&gt;bucket);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="default_flags=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="default_flags-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>default_flags</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
Amending format bit will also change #default_format value
</p>
</div>
  </div>

<p>
Default flags for new values.
</p>
<p>
The library reserves last two lower bits to store the format of the value.
The can be masked via FMT_MASK constant.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Selecting format bits
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_default_flags'>default_flags</span> <span class='op'>&amp;</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Bucket</span><span class='op'>::</span><span class='const'>FMT_MASK</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Set user defined bits
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_default_flags'>default_flags</span> <span class='op'>|=</span> <span class='int'>0x6660</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the effective flags
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1486
1487
1488
1489
1490
1491</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1486</span>

static VALUE
cb_bucket_default_flags_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return ULONG2NUM(bucket-&gt;default_flags);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="default_format=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="default_format-instance_method">
  
    - (<tt>Symbol</tt>) <strong>default_format</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
Amending default_format will also change #default_flags value
</p>
</div>
  </div>

<p>
Default format for new values.
</p>
<p>
It uses flags field to store the format. It accepts either the Symbol
(<tt>:document</tt>, <tt>:marshal</tt>, <tt>:plain</tt>) or Fixnum (use
constants FMT_DOCUMENT, FMT_MARSHAL, FMT_PLAIN) and silently ignores all
other value.
</p>
<p>
Here is some notes regarding how to choose the format:
</p>
<ul>
<li><p>
<tt>:document</tt> (default) format supports most of ruby types which could
be mapped to JSON data (hashes, arrays, strings, numbers). Future version
will be able to run map/reduce queries on the values in the document form
(hashes).
</p>
</li>
<li><p>
<tt>:plain</tt> format if you no need any conversions to be applied to your
data, but your data should be passed as String. It could be useful for
building custom algorithms or formats. For example implement set: <a
href="http://dustin.github.com/2011/02/17/memcached-set.html">dustin.github.com/2011/02/17/memcached-set.html</a>
</p>
</li>
<li><p>
<tt>:marshal</tt> format if you&#8217;d like to transparently serialize
your ruby object with standard <tt>Marshal.dump</tt> and
<tt>Marhal.load</tt> methods.
</p>
</li>
</ul>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Selecting plain format using symbol
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span> <span class='op'>=</span> <span class='symbol'>:document</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Selecting plain format using Fixnum constant
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_format'>format</span> <span class='op'>=</span> <span class='const'>Couchbase</span><span class='op'>::</span><span class='const'>Bucket</span><span class='op'>::</span><span class='const'>FMT_PLAIN</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the effective format
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1503
1504
1505
1506
1507
1508</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1503</span>

static VALUE
cb_bucket_default_format_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return bucket-&gt;default_format;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="hostname-instance_method">
  
    - (<tt>String</tt>) <strong>hostname</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The host name of the management interface (default:
&#8220;localhost&#8221;)
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the host name of the management interface (default:
&#8220;localhost&#8221;)
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1585
1586
1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1585</span>

static VALUE
cb_bucket_hostname_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    if (bucket-&gt;handle) {
        if (bucket-&gt;hostname) {
            xfree(bucket-&gt;hostname);
            bucket-&gt;hostname = NULL;
        }
        bucket-&gt;hostname = strdup(libcouchbase_get_host(bucket-&gt;handle));
        if (bucket-&gt;hostname == NULL) {
            rb_raise(eNoMemoryError, &quot;failed to allocate memory for Bucket&quot;);
        }
    }
    return STR_NEW_CSTR(bucket-&gt;hostname);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="on_error=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="on_error-instance_method">
  
    - (<tt>Proc</tt>) <strong>on_error</strong> {|op, key, exc| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Error callback for asynchronous mode.
</p>
<p>
This callback is using to deliver exceptions in asynchronous mode.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Using lambda syntax
</p>
</div></p>
      
      <pre class="example code">connection = Couchbase.new(:async =&gt; true)
connection.on_error = lambda {|op, key, exc| ... }
connection.run do |conn|
  conn.set(&quot;foo&quot;, &quot;bar&quot;)
end</pre>
    
      
        <p class="example_title"><div class='inline'><p>
Using block syntax
</p>
</div></p>
      
      <pre class="example code">connection = Couchbase.new(:async =&gt; true)
connection.on_error {|op, key, exc| ... }
...</pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>op</span>
      
      
        <span class='type'>(<tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The operation caused the error
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The key which cause the error or <tt>nil</tt>
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>exc</span>
      
      
        <span class='type'>(<tt>Exception</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The exception instance
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Proc</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the effective callback
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1550
1551
1552
1553
1554
1555
1556
1557
1558
1559
1560</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1550</span>

static VALUE
cb_bucket_on_error_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);

    if (rb_block_given_p()) {
        return cb_bucket_on_error_set(self, rb_block_proc());
    } else {
        return bucket-&gt;on_error_proc;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="password-instance_method">
  
    - (<tt>String</tt>) <strong>password</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The password for protected buckets
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the password for protected buckets
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1669
1670
1671
1672
1673
1674</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1669</span>

static VALUE
cb_bucket_password_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return STR_NEW_CSTR(bucket-&gt;password);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="pool-instance_method">
  
    - (<tt>String</tt>) <strong>pool</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The pool name (usually &#8220;default&#8221;)
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the pool name (usually &#8220;default&#8221;)
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1648
1649
1650
1651
1652
1653</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1648</span>

static VALUE
cb_bucket_pool_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return STR_NEW_CSTR(bucket-&gt;pool);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="port-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>port</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The port number of the management interface (default: 8091)
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the port number of the management interface (default: 8091)
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1605
1606
1607
1608
1609
1610
1611
1612
1613</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1605</span>

static VALUE
cb_bucket_port_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    if (bucket-&gt;handle) {
        bucket-&gt;port = atoi(libcouchbase_get_port(bucket-&gt;handle));
    }
    return UINT2NUM(bucket-&gt;port);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="quiet=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="quiet-instance_method">
  
    - (<tt>Boolean</tt>) <strong>quiet</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='quiet?-instance_method'>quiet?</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Flag specifying behaviour for operations on missing keys
</p>
<p>
If it is <tt>true</tt>, the operations will silently return <tt>nil</tt> or
<tt>false</tt> instead of raising <span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Error::NotFound</a></span>.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Hiding cache miss (considering &#8220;miss&#8221; key is not stored)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_quiet'>quiet</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>miss</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'>#=&gt; nil</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Raising errors on miss (considering &#8220;miss&#8221; key is not stored)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_quiet'>quiet</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>miss</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'>#=&gt; will raise Couchbase::Error::NotFound</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1468
1469
1470
1471
1472
1473</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1468</span>

static VALUE
cb_bucket_quiet_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return bucket-&gt;quiet ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="seqno-instance_method">
  
    - (<tt>Object</tt>) <strong>seqno</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The number of scheduled commands
</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


998
999
1000
1001
1002
1003
1004</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 998</span>

static VALUE
cb_bucket_seqno(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);

    return LONG2FIX(bucket-&gt;seqno);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="timeout=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="timeout-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>timeout</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The timeout for the operations. The client will raise
<span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Error::Timeout</a></span> exception for all commands which weren&#8217;t
completed in given timeslot.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The timeout for the operations. The client will raise
<span class='object_link'><a href="Error/Timeout.html" title="Couchbase::Error::Timeout (class)">Error::Timeout</a></span> exception for all commands which weren&#8217;t
completed in given timeslot.
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1562
1563
1564
1565
1566
1567</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1562</span>

static VALUE
cb_bucket_timeout_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return ULONG2NUM(bucket-&gt;timeout);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="url-instance_method">
  
    - (<tt>String</tt>) <strong>url</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The address of the cluster management interface
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the address of the cluster management interface
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1679
1680
1681
1682
1683
1684
1685
1686
1687
1688
1689
1690
1691
1692
1693
1694</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1679</span>

static VALUE
cb_bucket_url_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    VALUE str;

    (void)cb_bucket_authority_get(self);
    str = rb_str_buf_new2(&quot;http://&quot;);
    rb_str_buf_cat2(str, bucket-&gt;authority);
    rb_str_buf_cat2(str, &quot;/pools/&quot;);
    rb_str_buf_cat2(str, bucket-&gt;pool);
    rb_str_buf_cat2(str, &quot;/buckets/&quot;);
    rb_str_buf_cat2(str, bucket-&gt;bucket);
    rb_str_buf_cat2(str, &quot;/&quot;);
    return str;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="username-instance_method">
  
    - (<tt>String</tt>) <strong>username</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
The username for protected buckets (usually matches the bucket name)
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the username for protected buckets (usually matches the bucket name)
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1659
1660
1661
1662
1663
1664</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1659</span>

static VALUE
cb_bucket_username_get(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return STR_NEW_CSTR(bucket-&gt;username);
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="add-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>add</strong>(key, value, options = {}) {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Add the item to the database, but fail if the object exists already
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The CAS value of the object.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Add the same key twice
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; stored successully
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; will raise Couchbase::Error::KeyExists: failed to store value (key=&quot;foo&quot;, error=0x0c)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_flags</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Flags for storage options. Flags are ignored by the server but preserved
for use by the client. For more info see <span class='object_link'><a href="#default_flags-instance_method" title="Couchbase::Bucket#default_flags (method)">#default_flags</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CAS value of the object.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key already exists on the server
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/ValueFormat.html" title="Couchbase::Error::ValueFormat (class)">Couchbase::Error::ValueFormat</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the value cannot be serialized with chosen encoder, e.g. if you try to
store the Hash in <tt>:plain</tt> mode.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2959
2960
2961
2962
2963</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2959</span>

static VALUE
cb_bucket_add(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LIBCOUCHBASE_ADD, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="append-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>append</strong>(key, value, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
This operation is kind of data-aware from server point of view. This mean
that the server treats value as binary stream and just perform
concatenation, therefore it won&#8217;t work with <tt>:marshal</tt> and
<tt>:document</tt> formats, because of lack of knowledge how to merge
values in these formats. See Bucket#cas for workaround.
</p>
</div>
  </div>

<p>
Append this object to the existing object
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The CAS value of the object.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Simple append
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bbb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>           <span class='comment'>#=&gt; &quot;aaabbb&quot;</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Implementing sets using append
</p>
</div></p>
      
      <pre class="example code"><span class='kw'>def</span> <span class='id identifier rubyid_set_add'>set_add</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>+</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
  <span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded'>encoded</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_remove'>set_remove</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='op'>*</span><span class='id identifier rubyid_values'>values</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>=</span> <span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_flatten'>flatten</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span><span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_v'>v</span><span class='rbrace'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span>
  <span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_encoded'>encoded</span><span class='rparen'>)</span>
<span class='kw'>end</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_get'>set_get</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_encoded'>encoded</span> <span class='op'>=</span> <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ret'>ret</span> <span class='op'>=</span> <span class='const'>Set</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_encoded'>encoded</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'> </span><span class='tstring_end'>'</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_v'>v</span><span class='op'>|</span>
    <span class='id identifier rubyid_op'>op</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_v'>v</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_op'>op</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>+</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_add'>add</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_ret'>ret</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Using optimistic locking. The operation will fail on CAS mismatch
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_ver'>ver</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bbb</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ver'>ver</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CAS value of the object.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
on CAS mismatch
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotStored.html" title="Couchbase::Error::NotStored (class)">Couchbase::Error::NotStored</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key doesn&#8217;t exist
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


3062
3063
3064
3065
3066</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 3062</span>

static VALUE
cb_bucket_append(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LIBCOUCHBASE_APPEND, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="async?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>async?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Check whether the connection asynchronous.
</p>
<p>
By default all operations are synchronous and block waiting for results,
but you can make them asynchronous and run event loop explicitly. (see
<span class='object_link'><a href="#run-instance_method" title="Couchbase::Bucket#run (method)">#run</a></span>)
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Return value of #get operation depending on async flag
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_connection'>connection</span> <span class='op'>=</span> <span class='const'>Connection</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_async?'>async?</span>      <span class='comment'>#=&gt; false
</span>
<span class='id identifier rubyid_connection'>connection</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_conn'>conn</span><span class='op'>|</span>
  <span class='id identifier rubyid_conn'>conn</span><span class='period'>.</span><span class='id identifier rubyid_async?'>async?</span>          <span class='comment'>#=&gt; true
</span><span class='kw'>end</span></pre>
    
  </div>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<tt>true</tt> if the connection if asynchronous
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

  <p class="tag_title">See Also:</p>
  <ul class="see">
    
      <li><span class='object_link'><a href="#run-instance_method" title="Couchbase::Bucket#run (method)">#run</a></span></li>
    
  </ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1461
1462
1463
1464
1465
1466</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1461</span>

static VALUE
cb_bucket_async_p(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return bucket-&gt;async ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cas-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>cas</strong>(key, options = {}) {|value| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='compare_and_swap-instance_method'>compare_and_swap</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Reads a key&#8217;s value from the server and yields it to a block.
Replaces the key&#8217;s value with the result of the block as long as the
key hasn&#8217;t been updated in the meantime, otherwise raises
<span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Error::KeyExists</a></span>. CAS stands for &#8220;compare and
swap&#8221;, and avoids the need for manual key mutexing. Read more info
here:
</p>
<pre class="code ruby"><code>
  <span class='id identifier rubyid_http'>http</span><span class='symbol'>:/</span><span class='op'>/</span><span class='id identifier rubyid_docs'>docs</span><span class='period'>.</span><span class='id identifier rubyid_couchbase'>couchbase</span><span class='period'>.</span><span class='id identifier rubyid_org'>org</span><span class='op'>/</span><span class='id identifier rubyid_memcached'>memcached</span><span class='op'>-</span><span class='id identifier rubyid_api'>api</span><span class='op'>/</span><span class='id identifier rubyid_memcached'>memcached</span><span class='op'>-</span><span class='id identifier rubyid_api'>api</span><span class='op'>-</span><span class='id identifier rubyid_protocol'>protocol</span><span class='op'>-</span><span class='id identifier rubyid_text_cas'>text_cas</span><span class='period'>.</span><span class='id identifier rubyid_html'>html</span></code></pre>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Implement append to JSON encoded value
</p>
</div></p>
      
      <pre class="example code">
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_default_format'>default_format</span> <span class='op'>=</span> <span class='symbol'>:document</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>1</span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_val'>val</span><span class='op'>|</span>
  <span class='id identifier rubyid_val'>val</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='int'>2</span>
  <span class='id identifier rubyid_val'>val</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>      <span class='comment'>#=&gt; {&quot;bar&quot; =&gt; 1, &quot;baz&quot; =&gt; 2}</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>{}</tt>)</em>
      
      
        &mdash;
        <div class='inline'><p>
the options for operation
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>String</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
the time to live of this key
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
format of the value
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_flags</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
flags for this key
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>, <tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
old value in synchronous mode and <tt>Result</tt> object in asynchronous
mode.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Yield Returns:</p>
<ul class="yieldreturn">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
new value.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the CAS of new value
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key was updated before the the code in block has been completed (the
CAS value has been changed).
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


55
56
57
58
59
60
61
62
63
64
65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/couchbase/bucket.rb', line 55</span>

<span class='kw'>def</span> <span class='id identifier rubyid_cas'>cas</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='id identifier rubyid_options'>options</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_async?'>async?</span>
    <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
      <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_ret'>ret</span><span class='rparen'>)</span> <span class='comment'># get new value from caller
</span>      <span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span><span class='comma'>,</span> <span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_flags'>flags</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_ver'>ver</span> <span class='op'>=</span> <span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_val'>val</span> <span class='op'>=</span> <span class='kw'>yield</span><span class='lparen'>(</span><span class='id identifier rubyid_val'>val</span><span class='rparen'>)</span> <span class='comment'># get new value from caller
</span>    <span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ver'>ver</span><span class='comma'>,</span> <span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_flags'>flags</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connected?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>connected?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Check whether the instance connected to the cluster.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<tt>true</tt> if the instance connected to the cluster
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1435
1436
1437
1438
1439
1440</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1435</span>

static VALUE
cb_bucket_connected_p(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    return bucket-&gt;handle ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="decr-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>decr</strong>(key, delta = 1, options = {}) {|ret| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='decrement-instance_method'>decrement</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
that server values stored and transmitted as unsigned numbers, therefore if
you try to decrement negative or zero key, you will always get zero.
</p>
</div>
  </div>

<p>
Decrement the value of an existing numeric key
</p>
<p>
The decrement methods reduce the value of a given key if the corresponding
value can be parsed to an integer value. These operations are provided at a
protocol level to eliminate the need to get, update, and reset a simple
integer value in the database. It supports the use of an explicit offset
value that will be used to reduce the stored value in the database.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The actual value of the key.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key by one
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key by 50
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>50</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key by one <b>OR</b> initialize with zero
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:create</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; will return old-1 or 0</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key by one <b>OR</b> initialize with three
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>50</span><span class='comma'>,</span> <span class='symbol'>:initial</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='rparen'>)</span> <span class='comment'>#=&gt; will return old-50 or 3</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrement key and get its CAS value
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_cas'>cas</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrementing zero
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>0</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decrement'>decrement</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>100500</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; 0</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Decrementing negative value
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>100</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decrement'>decrement</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>100500</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; 0</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous invocation
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_decr'>decr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :decrement
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot;
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>delta</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Integer (up to 64 bits) value to decrement
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:create</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, it will initialize the key with zero value and
zero flags (use <tt>:initial</tt> option to set another initial value).
Note: it won&#8217;t decrement the missing value.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:initial</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>0</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Integer (up to 64 bits) value for missing key initialization. This option
imply <tt>:create</tt> option is <tt>true</tt>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch). This option ignored for
existent keys.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:extended</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation will return tuple <tt>[value, cas]</tt>,
otherwise (by default) it returns just value.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>, <tt>value</tt>,
<tt>cas</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the actual value of the key.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if key is missing and <tt>:create</tt> option isn&#8217;t <tt>true</tt>.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/DeltaBadval.html" title="Couchbase::Error::DeltaBadval (class)">Couchbase::Error::DeltaBadval</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key contains non-numeric value
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2185
2186
2187
2188
2189</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2185</span>

static VALUE
cb_bucket_decr(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_arithmetic(-1, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="delete-instance_method">
  
    - (<tt>Object</tt>) <strong>delete</strong>(key, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Delete the specified key
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Delete the key in quiet mode (default)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>        <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>        <span class='comment'>#=&gt; false</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Delete the key verbosely
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; true
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; will raise Couchbase::Error::NotFound</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Delete the key with version check
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_ver'>ver</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>          <span class='comment'>#=&gt; 5992859822302167040
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='int'>123456</span><span class='rparen'>)</span>    <span class='comment'>#=&gt; will raise Couchbase::Error::KeyExists
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ver'>ver</span><span class='rparen'>)</span>       <span class='comment'>#=&gt; true</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:quiet</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.quiet</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation won&#8217;t raise error for missing
key, it will return <tt>nil</tt>. Otherwise it will raise error in
synchronous mode. In asynchronous mode this option ignored.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update/delete an item simultaneously.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
on CAS mismatch
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if key is missing in verbose mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1768
1769
1770
1771
1772
1773
1774
1775
1776
1777
1778
1779
1780
1781
1782
1783
1784
1785
1786
1787
1788
1789
1790
1791
1792
1793
1794
1795
1796
1797
1798
1799
1800
1801
1802
1803
1804
1805
1806
1807
1808
1809
1810
1811
1812
1813
1814
1815
1816
1817
1818
1819
1820
1821
1822
1823
1824
1825
1826
1827
1828
1829
1830
1831
1832
1833
1834
1835
1836
1837
1838</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1768</span>

static VALUE
cb_bucket_delete(int argc, VALUE *argv, VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    context_t *ctx;
    VALUE k, c, rv, proc, exc, opts;
    char *key;
    size_t nkey;
    libcouchbase_cas_t cas = 0;
    libcouchbase_error_t err;
    long seqno;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;11&amp;&quot;, &amp;k, &amp;opts, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    k = unify_key(k);
    key = RSTRING_PTR(k);
    nkey = RSTRING_LEN(k);
    ctx = xcalloc(1, sizeof(context_t));
    ctx-&gt;quiet = bucket-&gt;quiet;
    if (ctx == NULL) {
        rb_raise(eNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    if (opts != Qnil) {
        if (TYPE(opts) == T_BIGNUM || TYPE(opts) == T_FIXNUM) {
            cas = NUM2ULL(opts);
        } else {
            Check_Type(opts, T_HASH);
            if ((c = rb_hash_aref(opts, sym_cas)) != Qnil) {
                cas = NUM2ULL(c);
            }
            if (RTEST(rb_funcall(opts, id_has_key_p, 1, sym_quiet))) {
                ctx-&gt;quiet = RTEST(rb_hash_aref(opts, sym_quiet));
            }
        }
    }
    ctx-&gt;proc = proc;
    cb_gc_protect(bucket, ctx-&gt;proc);
    rv = rb_ary_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;bucket = bucket;
    ctx-&gt;exception = Qnil;
    seqno = bucket-&gt;seqno;
    bucket-&gt;seqno++;
    err = libcouchbase_remove(bucket-&gt;handle, (const void *)ctx,
            (const void *)key, nkey, cas);
    exc = cb_check_error(err, &quot;failed to schedule delete request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    if (bucket-&gt;async) {
        return Qnil;
    } else {
        if (bucket-&gt;seqno - seqno &gt; 0) {
            /* we have some operations pending */
            bucket-&gt;io-&gt;run_event_loop(bucket-&gt;io);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        return rv;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="disconnect-instance_method">
  
    - (<tt>true</tt>) <strong>disconnect</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Close the connection to the cluster
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>true</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


3138
3139
3140
3141
3142
3143
3144
3145
3146
3147
3148
3149
3150
3151</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 3138</span>

static VALUE
cb_bucket_disconnect(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);

    if (bucket-&gt;handle) {
        libcouchbase_destroy(bucket-&gt;handle);
        bucket-&gt;handle = NULL;
        bucket-&gt;io = NULL;
        return Qtrue;
    } else {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flush-instance_method">
  
    - (<tt>Boolean</tt>) <strong>flush</strong> {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Deletes all values from a server
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
<tt>true</tt> on success
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Simple flush the bucket
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>    <span class='comment'>#=&gt; true</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous flush
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :flush
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_node'>node</span>        <span class='comment'>#=&gt; &quot;localhost:11211&quot;
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the object with <tt>error</tt>, <tt>node</tt> and <tt>operation</tt>
attributes.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<tt>true</tt> on success
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2522
2523
2524
2525
2526
2527
2528
2529
2530
2531
2532
2533
2534
2535
2536
2537
2538
2539
2540
2541
2542
2543
2544
2545
2546
2547
2548
2549
2550
2551
2552
2553
2554
2555
2556
2557
2558
2559
2560
2561
2562
2563
2564
2565
2566
2567
2568
2569
2570
2571
2572
2573
2574</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2522</span>

static VALUE
cb_bucket_flush(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    context_t *ctx;
    VALUE rv, exc;
    libcouchbase_error_t err;
    long seqno;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    if (!bucket-&gt;async &amp;&amp; rb_block_given_p()) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    ctx = xcalloc(1, sizeof(context_t));
    if (ctx == NULL) {
        rb_raise(eNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    rv = Qtrue;	/* optimistic by default */
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;bucket = bucket;
    ctx-&gt;exception = Qnil;
    if (rb_block_given_p()) {
        ctx-&gt;proc = rb_block_proc();
    } else {
        ctx-&gt;proc = Qnil;
    }
    cb_gc_protect(bucket, ctx-&gt;proc);
    seqno = bucket-&gt;seqno;
    bucket-&gt;seqno++;
    err = libcouchbase_flush(bucket-&gt;handle, (const void *)ctx);
    exc = cb_check_error(err, &quot;failed to schedule flush request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    if (bucket-&gt;async) {
        return Qnil;
    } else {
        if (bucket-&gt;seqno - seqno &gt; 0) {
            /* we have some operations pending */
            bucket-&gt;io-&gt;run_event_loop(bucket-&gt;io);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        return rv;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get-instance_method">
  
    
      <span class="overload">- (<tt>Object</tt>, ...) <strong>get</strong>(*keys, options = {}) {|ret| ... }</span>
    
      <span class="overload">- (<tt>Hash</tt>) <strong>get</strong>(keys, options = {}) </span>
    
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='[]-instance_method'>[]</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Obtain an object stored in Couchbase by given key.
</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Object</tt>, ...) <strong>get</strong>(*keys, options = {}) {|ret| ... }</span>
        <div class="docstring">
  <div class="discussion">
    <p>
The value(s) (or tuples in extended mode) assiciated with the key.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Get single value in quite mode (the default)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'>#=&gt; the associated value or nil</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use alternative hash-like syntax
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>         <span class='comment'>#=&gt; the associated value or nil</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get single value in verbose mode
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>missing-foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:quiet</span> <span class='op'>=&gt;</span> <span class='kw'>false</span><span class='rparen'>)</span>  <span class='comment'>#=&gt; raises Couchbase::NotFound</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get and touch single value. The key won&#8217;t be accessible after 10
seconds
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:ttl</span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Extended get
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_flags'>flags</span><span class='comma'>,</span> <span class='id identifier rubyid_cas'>cas</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>   <span class='comment'>#=&gt; [val1, val2, val3]</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Extended get multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; {&quot;foo&quot; =&gt; [val1, flags1, cas1], &quot;bar&quot; =&gt; [val2, flags2, cas2]}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous get
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_res'>res</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :get
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot;, &quot;bar&quot; or &quot;baz&quot; in separate calls
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_flags'>flags</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>, <tt>Array</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
One or several keys to fetch
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:extended</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation will return tuple +[value, flags,
cas]+, otherwise (by default) it returns just value.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:quiet</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.quiet</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation won&#8217;t raise error for missing
key, it will return <tt>nil</tt>. Otherwise it will raise error in
synchronous mode. In asynchronous mode this option ignored.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>nil</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Explicitly choose the decoder for this key (<tt>:plain</tt>,
<tt>:document</tt>, <tt>:marshal</tt>). See <span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>, <tt>value</tt>,
<tt>flags</tt>, <tt>cas</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Object</tt>, <tt>Array</tt>, <tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the value(s) (or tuples in extended mode) assiciated with the key.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key is missing in the bucket.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Hash</tt>) <strong>get</strong>(keys, options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
When the method receive hash map, it will behave like it receive list of
keys (<tt>keys.keys</tt>), but also touch each key setting expiry time to
the corresponding value. But unlike usual get this command always return
hash map <tt>{key =&gt; value}</tt> or <tt>{key =&gt; [value, flags, cas]}</tt>.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Get and touch multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; {&quot;foo&quot; =&gt; val1, &quot;bar&quot; =&gt; val2}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Extended get and touch multiple keys
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
<span class='comment'>#=&gt; {&quot;foo&quot; =&gt; [val1, flags1, cas1], &quot;bar&quot; =&gt; [val2, flags2, cas2]}</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Map key-ttl
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation. (see options definition above)
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the values (or tuples in extended mode) assiciated with the keys.
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2279
2280
2281
2282
2283
2284
2285
2286
2287
2288
2289
2290
2291
2292
2293
2294
2295
2296
2297
2298
2299
2300
2301
2302
2303
2304
2305
2306
2307
2308
2309
2310
2311
2312
2313
2314
2315
2316
2317
2318
2319
2320
2321
2322
2323
2324
2325
2326
2327
2328
2329
2330
2331
2332
2333
2334
2335
2336
2337
2338
2339
2340
2341
2342
2343
2344
2345
2346
2347
2348
2349
2350
2351
2352
2353
2354
2355
2356
2357
2358
2359
2360
2361
2362
2363
2364
2365</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2279</span>

static VALUE
cb_bucket_get(int argc, VALUE *argv, VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    context_t *ctx;
    VALUE args, rv, proc, exc, keys;
    long nn;
    libcouchbase_error_t err;
    struct key_traits *traits;
    int extended, mgat;
    long seqno;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    rb_funcall(args, id_flatten_bang, 0);
    traits = xcalloc(1, sizeof(struct key_traits));
    nn = cb_args_scan_keys(RARRAY_LEN(args), args, bucket, traits);
    ctx = xcalloc(1, sizeof(context_t));
    if (ctx == NULL) {
        rb_raise(eNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    mgat = traits-&gt;mgat;
    keys = traits-&gt;keys_ary;
    ctx-&gt;proc = proc;
    cb_gc_protect(bucket, ctx-&gt;proc);
    ctx-&gt;bucket = bucket;
    ctx-&gt;extended = traits-&gt;extended;
    ctx-&gt;quiet = traits-&gt;quiet;
    ctx-&gt;force_format = traits-&gt;force_format;
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;exception = Qnil;
    seqno = bucket-&gt;seqno;
    bucket-&gt;seqno += nn;
    err = libcouchbase_mget(bucket-&gt;handle, (const void *)ctx,
            traits-&gt;nkeys, (const void * const *)traits-&gt;keys,
            traits-&gt;lens, (traits-&gt;explicit_ttl) ? traits-&gt;ttls : NULL);
    xfree(traits-&gt;keys);
    xfree(traits-&gt;lens);
    xfree(traits-&gt;ttls);
    xfree(traits);
    exc = cb_check_error(err, &quot;failed to schedule get request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    if (bucket-&gt;async) {
        return Qnil;
    } else {
        if (bucket-&gt;seqno - seqno &gt; 0) {
            /* we have some operations pending */
            bucket-&gt;io-&gt;run_event_loop(bucket-&gt;io);
        }
        exc = ctx-&gt;exception;
        extended = ctx-&gt;extended;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        if (mgat || (extended &amp;&amp; nn &gt; 1)) {
            return rv;  /* return as a hash {key =&gt; [value, flags, cas], ...} */
        }
        if (nn &gt; 1) {
            long ii;
            VALUE *keys_ptr, ret;
            ret = rb_ary_new();
            keys_ptr = RARRAY_PTR(keys);
            for (ii = 0; ii &lt; nn; ii++) {
                rb_ary_push(ret, rb_hash_aref(rv, keys_ptr[ii]));
            }
            return ret;  /* return as an array [value1, value2, ...] */
        } else {
            VALUE vv = Qnil;
            rb_hash_foreach(rv, cb_first_value_i, (VALUE)&amp;vv);
            return vv;
        }
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="incr-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>incr</strong>(key, delta = 1, options = {}) {|ret| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='increment-instance_method'>increment</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
that server values stored and transmitted as unsigned numbers, therefore if
you try to store negative number and then increment or decrement it will
cause overflow. (see &#8220;Integer overflow&#8221; example below)
</p>
</div>
  </div>

<p>
Increment the value of an existing numeric key
</p>
<p>
The increment methods enable you to increase a given stored integer value.
These are the incremental equivalent of the decrement operations and work
on the same basis; updating the value of a key if it can be parsed to an
integer. The update operation occurs on the server and is provided at the
protocol level. This simplifies what would otherwise be a two-stage get and
set operation.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The actual value of the key.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key by one
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key by 50
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>50</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key by one <b>OR</b> initialize with zero
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:create</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; will return old+1 or 0</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key by one <b>OR</b> initialize with three
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>50</span><span class='comma'>,</span> <span class='symbol'>:initial</span> <span class='op'>=&gt;</span> <span class='int'>3</span><span class='rparen'>)</span> <span class='comment'>#=&gt; will return old+50 or 3</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Increment key and get its CAS value
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_val'>val</span><span class='comma'>,</span> <span class='id identifier rubyid_cas'>cas</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:extended</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Integer overflow
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='op'>-</span><span class='int'>100</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>           <span class='comment'>#=&gt; -100
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>          <span class='comment'>#=&gt; 18446744073709551517</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous invocation
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_incr'>incr</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :increment
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot;
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>delta</span>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Integer (up to 64 bits) value to increment
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:create</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, it will initialize the key with zero value and
zero flags (use <tt>:initial</tt> option to set another initial value).
Note: it won&#8217;t increment the missing value.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:initial</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>0</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Integer (up to 64 bits) value for missing key initialization. This option
imply <tt>:create</tt> option is <tt>true</tt>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch). This option ignored for
existent keys.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:extended</span>
          <span class="type">(<tt>Boolean</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>false</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
If set to <tt>true</tt>, the operation will return tuple <tt>[value, cas]</tt>,
otherwise (by default) it returns just value.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>, <tt>value</tt>,
<tt>cas</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the actual value of the key.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if key is missing and <tt>:create</tt> option isn&#8217;t <tt>true</tt>.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/DeltaBadval.html" title="Couchbase::Error::DeltaBadval (class)">Couchbase::Error::DeltaBadval</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key contains non-numeric value
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2096
2097
2098
2099
2100</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2096</span>

static VALUE
cb_bucket_incr(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_arithmetic(+1, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="initialize_copy-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>) <strong>initialize_copy</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Initialize copy
</p>
<p>
Initializes copy of the object, used by #dup
</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>orig</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the source for copy
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Couchbase::Bucket</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1356
1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385
1386
1387
1388
1389
1390
1391
1392
1393
1394
1395
1396
1397
1398
1399</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1356</span>

static VALUE
cb_bucket_init_copy(VALUE copy, VALUE orig)
{
    bucket_t *copy_b;
    bucket_t *orig_b;

    if (copy == orig)
        return copy;

    if (TYPE(orig) != T_DATA || TYPE(copy) != T_DATA ||
            RDATA(orig)-&gt;dfree != (RUBY_DATA_FUNC)cb_bucket_free) {
        rb_raise(rb_eTypeError, &quot;wrong argument type&quot;);
    }

    copy_b = DATA_PTR(copy);
    orig_b = DATA_PTR(orig);

    copy_b-&gt;port = orig_b-&gt;port;
    copy_b-&gt;authority = strdup(orig_b-&gt;authority);
    copy_b-&gt;hostname = strdup(orig_b-&gt;hostname);
    copy_b-&gt;pool = strdup(orig_b-&gt;pool);
    copy_b-&gt;bucket = strdup(orig_b-&gt;bucket);
    if (orig_b-&gt;username) {
        copy_b-&gt;username = strdup(orig_b-&gt;username);
    }
    if (orig_b-&gt;password) {
        copy_b-&gt;password = strdup(orig_b-&gt;password);
    }
    copy_b-&gt;async = orig_b-&gt;async;
    copy_b-&gt;quiet = orig_b-&gt;quiet;
    copy_b-&gt;seqno = orig_b-&gt;seqno;
    copy_b-&gt;default_format = orig_b-&gt;default_format;
    copy_b-&gt;default_flags = orig_b-&gt;default_flags;
    copy_b-&gt;default_ttl = orig_b-&gt;default_ttl;
    copy_b-&gt;timeout = orig_b-&gt;timeout;
    copy_b-&gt;exception = Qnil;
    if (orig_b-&gt;on_error_proc != Qnil) {
        copy_b-&gt;on_error_proc = rb_funcall(orig_b-&gt;on_error_proc, id_dup, 0);
    }

    do_connect(copy_b);

    return copy;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="inspect-instance_method">
  
    - (<tt>String</tt>) <strong>inspect</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns a string containing a human-readable representation of the Bucket.
</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1702
1703
1704
1705
1706
1707
1708
1709
1710
1711
1712
1713
1714
1715
1716
1717
1718
1719
1720
1721
1722
1723
1724
1725
1726
1727
1728
1729
1730</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1702</span>

static VALUE
cb_bucket_inspect(VALUE self)
{
    VALUE str;
    bucket_t *bucket = DATA_PTR(self);
    char buf[200];

    str = rb_str_buf_new2(&quot;#&lt;&quot;);
    rb_str_buf_cat2(str, rb_obj_classname(self));
    snprintf(buf, 25, &quot;:%p \&quot;&quot;, (void *)self);
    (void)cb_bucket_authority_get(self);
    rb_str_buf_cat2(str, buf);
    rb_str_buf_cat2(str, &quot;http://&quot;);
    rb_str_buf_cat2(str, bucket-&gt;authority);
    rb_str_buf_cat2(str, &quot;/pools/&quot;);
    rb_str_buf_cat2(str, bucket-&gt;pool);
    rb_str_buf_cat2(str, &quot;/buckets/&quot;);
    rb_str_buf_cat2(str, bucket-&gt;bucket);
    rb_str_buf_cat2(str, &quot;/&quot;);
    snprintf(buf, 150, &quot;\&quot; default_format=:%s, default_flags=0x%x, quiet=%s, connected=%s, timeout=%u&gt;&quot;,
            rb_id2name(SYM2ID(bucket-&gt;default_format)),
            bucket-&gt;default_flags,
            bucket-&gt;quiet ? &quot;true&quot; : &quot;false&quot;,
            bucket-&gt;handle ? &quot;true&quot; : &quot;false&quot;,
            bucket-&gt;timeout);
    rb_str_buf_cat2(str, buf);

    return str;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="prepend-instance_method">
  
    - (<tt>Object</tt>) <strong>prepend</strong>(key, value, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
  <div class="note notetag">
    <strong>Note:</strong>
    <div class='inline'><p>
This operation is kind of data-aware from server point of view. This mean
that the server treats value as binary stream and just perform
concatenation, therefore it won&#8217;t work with <tt>:marshal</tt> and
<tt>:document</tt> formats, because of lack of knowledge how to merge
values in these formats. See Bucket#cas for workaround.
</p>
</div>
  </div>

<p>
Prepend this object to the existing object
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Simple prepend example
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_prepend'>prepend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bbb</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>           <span class='comment'>#=&gt; &quot;bbbaaa&quot;</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Using explicit format option
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_default_format'>default_format</span>       <span class='comment'>#=&gt; :document
</span><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>y</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>z</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_prepend'>prepend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>[</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:plain</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_append'>append</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>, {&quot;z&quot;: &quot;y&quot;}]</span><span class='tstring_end'>'</span></span><span class='comma'>,</span> <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:plain</span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>           <span class='comment'>#=&gt; [{&quot;y&quot;=&gt;&quot;z&quot;}, {&quot;z&quot;=&gt;&quot;y&quot;}]</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Using optimistic locking. The operation will fail on CAS mismatch
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_ver'>ver</span> <span class='op'>=</span> <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>aaa</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_prepend'>prepend</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bbb</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ver'>ver</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
on CAS mismatch
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotStored.html" title="Couchbase::Error::NotStored (class)">Couchbase::Error::NotStored</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key doesn&#8217;t exist
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


3111
3112
3113
3114
3115</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 3111</span>

static VALUE
cb_bucket_prepend(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LIBCOUCHBASE_PREPEND, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reconnect-instance_method">
  
    
      <span class="overload">- (<tt>Object</tt>) <strong>reconnect</strong>(url, options = {}) </span>
    
      <span class="overload">- (<tt>Object</tt>) <strong>reconnect</strong>(options = {}) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Reconnect the bucket
</p>
<p>
Reconnect the bucket using initial configuration with optional
redefinition.
</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Object</tt>) <strong>reconnect</strong>(url, options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
see <span class='object_link'><a href="#initialize-instance_method" title="Couchbase::Bucket#initialize (method)">Bucket#initialize(url, options)</a></span>
</p>


  </div>
</div>
<div class="tags">
  

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Object</tt>) <strong>reconnect</strong>(options = {}) </span>
        <div class="docstring">
  <div class="discussion">
    <p>
see <span class='object_link'><a href="#initialize-instance_method" title="Couchbase::Bucket#initialize (method)">Bucket#initialize(options)</a></span>
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
reconnect with current parameters
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_reconnect'>reconnect</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
reconnect the instance to another bucket
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_reconnect'>reconnect</span><span class='lparen'>(</span><span class='symbol'>:bucket</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>'</span><span class='tstring_content'>new</span><span class='tstring_end'>'</span></span><span class='rparen'>)</span></pre>
    
  </div>


</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1419
1420
1421
1422
1423
1424
1425
1426
1427
1428</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 1419</span>

static VALUE
cb_bucket_reconnect(int argc, VALUE *argv, VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);

    do_scan_connection_options(bucket, argc, argv);
    do_connect(bucket);

    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="replace-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>replace</strong>(key, value, options = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Replace the existing object in the database
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The CAS value of the object.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Replacing missing key
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>baz</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>  <span class='comment'>#=&gt; will raise Couchbase::Error::NotFound: failed to store value (key=&quot;foo&quot;, error=0x0d)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_flags</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Flags for storage options. Flags are ignored by the server but preserved
for use by the client. For more info see <span class='object_link'><a href="#default_flags-instance_method" title="Couchbase::Bucket#default_flags (method)">#default_flags</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CAS value of the object.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/NotFound.html" title="Couchbase::Error::NotFound (class)">Couchbase::Error::NotFound</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key doesn&#8217;t exists
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
on CAS mismatch
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2992
2993
2994
2995
2996</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2992</span>

static VALUE
cb_bucket_replace(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LIBCOUCHBASE_REPLACE, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="run-instance_method">
  
    - (<tt>nil</tt>) <strong>run</strong> {|bucket| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Run the event loop.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Use block to run the loop
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use lambda to run the loop
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span> <span class='op'>=</span> <span class='const'>Couchbase</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
<span class='id identifier rubyid_operations'>operations</span> <span class='op'>=</span> <span class='id identifier rubyid_lambda'>lambda</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_c'>c</span><span class='op'>|</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_get'>get</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span><span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span> <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='rbrace'>}</span>
<span class='kw'>end</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='id identifier rubyid_operations'>operations</span><span class='rparen'>)</span></pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>bucket</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="" title="Couchbase::Bucket (class)">Bucket</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the bucket instance
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2834
2835
2836
2837
2838
2839
2840
2841
2842
2843
2844</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2834</span>

static VALUE
cb_bucket_run(VALUE self)
{
    VALUE args[2];

    rb_need_block();
    args[0] = self;
    args[1] = rb_block_proc();
    rb_ensure(do_run, (VALUE)args, ensure_run, (VALUE)args);
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set-instance_method">
  
    - (<tt>Fixnum</tt>) <strong>set</strong>(key, value, options = {}) {|ret| ... }
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='[]=-instance_method'>[]=</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Unconditionally store the object in the Couchbase
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
The CAS value of the object.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Store the key which will be expired in 2 seconds using relative TTL.
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:ttl</span> <span class='op'>=&gt;</span> <span class='int'>2</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Store the key which will be expired in 2 seconds using absolute TTL.
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:ttl</span> <span class='op'>=&gt;</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span> <span class='op'>+</span> <span class='int'>2</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Force JSON document format for value
</p>
</div></p>
      
      <pre class="example code">c.set(&quot;foo&quot;, {&quot;bar&quot; =&gt; &quot;baz}, :format =&gt; :document)</pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use hash-like syntax to store the value
</p>
</div></p>
      
      <pre class="example code">c.set[&quot;foo&quot;] = {&quot;bar&quot; =&gt; &quot;baz}</pre>
    
      
        <p class="example_title"><div class='inline'><p>
Use extended hash-like syntax
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='int'>0x1000</span><span class='comma'>,</span> <span class='symbol'>:format</span> <span class='op'>=&gt;</span> <span class='symbol'>:plain</span><span class='rbrace'>}</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>
<span class='id identifier rubyid_c'>c</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='int'>0x1000</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span>  <span class='comment'># for ruby 1.9.x only</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Set application specific flags (note that it will be OR-ed with format
flags)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:flags</span> <span class='op'>=&gt;</span> <span class='int'>0x1000</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Perform optimistic locking by specifying last known CAS version
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:cas</span> <span class='op'>=&gt;</span> <span class='int'>8835713818674332672</span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Perform asynchronous call
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>bar</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :set
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot;
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_cas'>cas</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>value</span>
      
      
        <span class='type'>(<tt>Object</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Value to be stored
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:flags</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_flags</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Flags for storage options. Flags are ignored by the server but preserved
for use by the client. For more info see <span class='object_link'><a href="#default_flags-instance_method" title="Couchbase::Bucket#default_flags (method)">#default_flags</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:format</span>
          <span class="type">(<tt>Symbol</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_format</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
The representation for storing the value in the bucket. For more info see
<span class='object_link'><a href="#default_format-instance_method" title="Couchbase::Bucket#default_format (method)">#default_format</a></span>.
</p>
</div>
          
        </li>
      
        <li>
          <span class="name">:cas</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
          </span>
          
            &mdash; <div class='inline'><p>
The CAS value for an object. This value created on the server and is
guaranteed to be unique for each value of a given key. This value is used
to provide simple optimistic concurrency control when multiple clients or
threads try to update an item simultaneously.
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Fixnum</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The CAS value of the object.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>).
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/KeyExists.html" title="Couchbase::Error::KeyExists (class)">Couchbase::Error::KeyExists</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the key already exists on the server.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/ValueFormat.html" title="Couchbase::Error::ValueFormat (class)">Couchbase::Error::ValueFormat</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if the value cannot be serialized with chosen encoder, e.g. if you try to
store the Hash in <tt>:plain</tt> mode.
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2914
2915
2916
2917
2918</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2914</span>

static VALUE
cb_bucket_set(int argc, VALUE *argv, VALUE self)
{
    return cb_bucket_store(LIBCOUCHBASE_SET, argc, argv, self);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stats-instance_method">
  
    - (<tt>Hash</tt>) <strong>stats</strong>(arg = nil) {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Request server statistics.
</p>
<p>
Fetches stats from each node in cluster. Without a key specified the server
will respond with a &#8220;default&#8221; set of statistical information.
In asynchronous mode each statistic is returned in separate call where the
Result object yielded (<tt>#key</tt> contains the name of the statistical
item and the <tt>#value</tt> contains the value, the <tt>#node</tt> will
indicate the server address). In synchronous mode it returns the hash of
stats keys and node-value pairs as a value.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
Where keys are stat keys, values are host-value pairs
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Found how many items in the bucket
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total_items</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='op'>|</span>
  <span class='id identifier rubyid_total'>total</span> <span class='op'>+=</span> <span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Found total items number asynchronously
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_total'>total</span> <span class='op'>=</span> <span class='int'>0</span>
<span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>total_items</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_total'>total</span> <span class='op'>+=</span> <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Get memory stats (works on couchbase buckets)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_stats'>stats</span><span class='lparen'>(</span><span class='symbol'>:memory</span><span class='rparen'>)</span>   <span class='comment'>#=&gt; {&quot;mem_used&quot;=&gt;{...}, ...}</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>arg</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
argument to STATS query
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the object with <tt>node</tt>, <tt>key</tt> and <tt>value</tt> attributes.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
where keys are stat keys, values are host-value pairs
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2695
2696
2697
2698
2699
2700
2701
2702
2703
2704
2705
2706
2707
2708
2709
2710
2711
2712
2713
2714
2715
2716
2717
2718
2719
2720
2721
2722
2723
2724
2725
2726
2727
2728
2729
2730
2731
2732
2733
2734
2735
2736
2737
2738
2739
2740
2741
2742
2743
2744
2745
2746
2747
2748
2749
2750
2751
2752
2753
2754
2755
2756
2757
2758
2759
2760
2761</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2695</span>

static VALUE
cb_bucket_stats(int argc, VALUE *argv, VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    context_t *ctx;
    VALUE rv, exc, arg, proc;
    char *key;
    size_t nkey;
    libcouchbase_error_t err;
    long seqno;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;01&amp;&quot;, &amp;arg, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }

    ctx = xcalloc(1, sizeof(context_t));
    if (ctx == NULL) {
        rb_raise(eNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;bucket = bucket;
    ctx-&gt;proc = proc;
    cb_gc_protect(bucket, ctx-&gt;proc);
    ctx-&gt;exception = Qnil;
    if (arg != Qnil) {
        arg = unify_key(arg);
        key = RSTRING_PTR(arg);
        nkey = RSTRING_LEN(arg);
    } else {
        key = NULL;
        nkey = 0;
    }
    seqno = bucket-&gt;seqno;
    bucket-&gt;seqno++;
    err = libcouchbase_server_stats(bucket-&gt;handle, (const void *)ctx,
            key, nkey);
    exc = cb_check_error(err, &quot;failed to schedule stat request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    if (bucket-&gt;async) {
        return Qnil;
    } else {
        if (bucket-&gt;seqno - seqno &gt; 0) {
            /* we have some operations pending */
            bucket-&gt;io-&gt;run_event_loop(bucket-&gt;io);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        return rv;
    }

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="touch-instance_method">
  
    
      <span class="overload">- (<tt>Boolean</tt>) <strong>touch</strong>(key, options = {}) {|ret| ... }</span>
    
      <span class="overload">- (<tt>Hash</tt>) <strong>touch</strong>(keys) {|ret| ... }</span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Update the expiry time of an item
</p>
<p>
The <tt>touch</tt> method allow you to update the expiration time on a
given key. This can be useful for situations where you want to prevent an
item from expiring without resetting the associated value. For example, for
a session database you might want to keep the session alive in the database
each time the user accesses a web page without explicitly updating the
session value, keeping the user&#8217;s session active and available.
</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Boolean</tt>) <strong>touch</strong>(key, options = {}) {|ret| ... }</span>
        <div class="docstring">
  <div class="discussion">
    <p>
<tt>true</tt> if the operation was successful and <tt>false</tt> otherwise.
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Touch value using <tt>default_ttl</tt>
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Touch value using custom TTL (10 seconds)
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='symbol'>:ttl</span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='rparen'>)</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>key</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>Symbol</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Key used to reference the value.
</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>options</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Options for operation.
</p>
</div>
      
    </li>
  
</ul>

  
    
    
    
    
    <p class="tag_title">Options Hash (<tt>options</tt>):</p>
    <ul class="option">
      
        <li>
          <span class="name">:ttl</span>
          <span class="type">(<tt>Fixnum</tt>)</span>
          <span class="default">
            
              &mdash; default:
              <tt>self.default_ttl</tt>
            
          </span>
          
            &mdash; <div class='inline'><p>
Expiry time for key. Values larger than 30*24*60*60 seconds (30 days) are
interpreted as absolute times (from the epoch).
</p>
</div>
          
        </li>
      
    </ul>
  

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation in asynchronous mode (valid attributes:
<tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
<tt>true</tt> if the operation was successful and <tt>false</tt> otherwise.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Hash</tt>) <strong>touch</strong>(keys) {|ret| ... }</span>
        <div class="docstring">
  <div class="discussion">
    <p>
Mapping keys to result of touch operation (<tt>true</tt> if the operation
was successful and <tt>false</tt> otherwise)
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Touch several values
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='symbol'>:bar</span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rparen'>)</span> <span class='comment'>#=&gt; {&quot;foo&quot; =&gt; true, &quot;bar&quot; =&gt; true}</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Touch several values in async mode
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='comma'>,</span> <span class='symbol'>:bar</span> <span class='op'>=&gt;</span> <span class='int'>20</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>   <span class='comment'>#=&gt; :touch
</span>     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>    <span class='comment'>#=&gt; true
</span>     <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_key'>key</span>         <span class='comment'>#=&gt; &quot;foo&quot; and &quot;bar&quot; in separate calls
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Touch single value
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_touch'>touch</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>foo</span><span class='tstring_end'>&quot;</span></span> <span class='op'>=&gt;</span> <span class='int'>10</span><span class='rparen'>)</span>             <span class='comment'>#=&gt; true</span></pre>
    
  </div>
<p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>keys</span>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
The Hash where keys represent the keys in the database, values &#8212; the
expiry times for corresponding key. See description of <tt>:ttl</tt>
argument above for more information about TTL values.
</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the result of operation for each key in asynchronous mode (valid
attributes: <tt>error</tt>, <tt>operation</tt>, <tt>key</tt>).
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
Mapping keys to result of touch operation (<tt>true</tt> if the operation
was successful and <tt>false</tt> otherwise)
</p>
</div>
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2428
2429
2430
2431
2432
2433
2434
2435
2436
2437
2438
2439
2440
2441
2442
2443
2444
2445
2446
2447
2448
2449
2450
2451
2452
2453
2454
2455
2456
2457
2458
2459
2460
2461
2462
2463
2464
2465
2466
2467
2468
2469
2470
2471
2472
2473
2474
2475
2476
2477
2478
2479
2480
2481
2482
2483
2484
2485
2486
2487
2488
2489
2490
2491
2492
2493
2494
2495
2496</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2428</span>

static VALUE
cb_bucket_touch(int argc, VALUE *argv, VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    context_t *ctx;
    VALUE args, rv, proc, exc;
    size_t nn;
    libcouchbase_error_t err;
    struct key_traits *traits;
    long seqno;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    rb_scan_args(argc, argv, &quot;0*&amp;&quot;, &amp;args, &amp;proc);
    if (!bucket-&gt;async &amp;&amp; proc != Qnil) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    rb_funcall(args, id_flatten_bang, 0);
    traits = xcalloc(1, sizeof(struct key_traits));
    nn = cb_args_scan_keys(RARRAY_LEN(args), args, bucket, traits);
    ctx = xcalloc(1, sizeof(context_t));
    if (ctx == NULL) {
        rb_raise(eNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    ctx-&gt;proc = proc;
    cb_gc_protect(bucket, ctx-&gt;proc);
    ctx-&gt;bucket = bucket;
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;exception = Qnil;
    seqno = bucket-&gt;seqno;
    bucket-&gt;seqno += nn;
    err = libcouchbase_mtouch(bucket-&gt;handle, (const void *)ctx,
            traits-&gt;nkeys, (const void * const *)traits-&gt;keys,
            traits-&gt;lens, traits-&gt;ttls);
    xfree(traits-&gt;keys);
    xfree(traits-&gt;lens);
    xfree(traits);
    exc = cb_check_error(err, &quot;failed to schedule touch request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    if (bucket-&gt;async) {
        return Qnil;
    } else {
        if (bucket-&gt;seqno - seqno &gt; 0) {
            /* we have some operations pending */
            bucket-&gt;io-&gt;run_event_loop(bucket-&gt;io);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        if (bucket-&gt;exception != Qnil) {
            rb_exc_raise(bucket-&gt;exception);
        }
        if (nn &gt; 1) {
            return rv;  /* return as a hash {key =&gt; true, ...} */
        } else {
            VALUE vv = Qnil;
            rb_hash_foreach(rv, cb_first_value_i, (VALUE)&amp;vv);
            return vv;
        }
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="version-instance_method">
  
    - (<tt>Hash</tt>) <strong>version</strong> {|ret| ... }
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>
Returns versions of the server for each node in the cluster
</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    <p>
Node-version pairs
</p>


  </div>
</div>
<div class="tags">
  
  <div class="examples">
    <p class="tag_title">Examples:</p>
    
      
        <p class="example_title"><div class='inline'><p>
Synchronous version request
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span>            <span class='comment'>#=&gt; will render version</span></pre>
    
      
        <p class="example_title"><div class='inline'><p>
Asynchronous version request
</p>
</div></p>
      
      <pre class="example code"><span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>
  <span class='id identifier rubyid_c'>c</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ret'>ret</span><span class='op'>|</span>
    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_operation'>operation</span>    <span class='comment'>#=&gt; :version
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_success?'>success?</span>     <span class='comment'>#=&gt; true
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_node'>node</span>         <span class='comment'>#=&gt; &quot;localhost:11211&quot;
</span>    <span class='id identifier rubyid_ret'>ret</span><span class='period'>.</span><span class='id identifier rubyid_value'>value</span>        <span class='comment'>#=&gt; will render version
</span>  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    
  </div>

<p class="tag_title">Yield Parameters:</p>
<ul class="yieldparam">
  
    <li>
      
        <span class='name'>ret</span>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Result.html" title="Couchbase::Result (class)">Result</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
the object with <tt>error</tt>, <tt>node</tt>, <tt>operation</tt> and
<tt>value</tt> attributes.
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
node-version pairs
</p>
</div>
      
    </li>
  
</ul>
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Error/Connect.html" title="Couchbase::Error::Connect (class)">Couchbase::Error::Connect</a></span></tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
if connection closed (see <span class='object_link'><a href="#reconnect-instance_method" title="Couchbase::Bucket#reconnect (method)">#reconnect</a></span>)
</p>
</div>
      
    </li>
  
    <li>
      
      
        <span class='type'>(<tt>ArgumentError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>
when passing the block in synchronous mode
</p>
</div>
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


2601
2602
2603
2604
2605
2606
2607
2608
2609
2610
2611
2612
2613
2614
2615
2616
2617
2618
2619
2620
2621
2622
2623
2624
2625
2626
2627
2628
2629
2630
2631
2632
2633
2634
2635
2636
2637
2638
2639
2640
2641
2642
2643
2644
2645
2646
2647
2648
2649
2650
2651
2652
2653</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/couchbase_ext/couchbase_ext.c', line 2601</span>

static VALUE
cb_bucket_version(VALUE self)
{
    bucket_t *bucket = DATA_PTR(self);
    context_t *ctx;
    VALUE rv, exc;
    libcouchbase_error_t err;
    long seqno;

    if (bucket-&gt;handle == NULL) {
        rb_raise(eConnectError, &quot;closed connection&quot;);
    }
    if (!bucket-&gt;async &amp;&amp; rb_block_given_p()) {
        rb_raise(rb_eArgError, &quot;synchronous mode doesn't support callbacks&quot;);
    }
    ctx = xcalloc(1, sizeof(context_t));
    if (ctx == NULL) {
        rb_raise(eNoMemoryError, &quot;failed to allocate memory for context&quot;);
    }
    rv = rb_hash_new();
    ctx-&gt;rv = &amp;rv;
    ctx-&gt;bucket = bucket;
    ctx-&gt;exception = Qnil;
    if (rb_block_given_p()) {
        ctx-&gt;proc = rb_block_proc();
    } else {
        ctx-&gt;proc = Qnil;
    }
    cb_gc_protect(bucket, ctx-&gt;proc);
    seqno = bucket-&gt;seqno;
    bucket-&gt;seqno++;
    err = libcouchbase_server_versions(bucket-&gt;handle, (const void *)ctx);
    exc = cb_check_error(err, &quot;failed to schedule version request&quot;, Qnil);
    if (exc != Qnil) {
        xfree(ctx);
        rb_exc_raise(exc);
    }
    if (bucket-&gt;async) {
        return Qnil;
    } else {
        if (bucket-&gt;seqno - seqno &gt; 0) {
            /* we have some operations pending */
            bucket-&gt;io-&gt;run_event_loop(bucket-&gt;io);
        }
        exc = ctx-&gt;exception;
        xfree(ctx);
        if (exc != Qnil) {
            cb_gc_unprotect(bucket, exc);
            rb_exc_raise(exc);
        }
        return rv;
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Tue Sep 18 17:47:56 2012 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.2.1 (ruby-1.9.2).
</div>

  </body>
</html>